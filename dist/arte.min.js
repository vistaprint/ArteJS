!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function a(a,b){var c=typeof a[b];return c==s||!(c!=r||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=r||!a[b])}function c(a,b){return typeof a[b]!=t}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&y(a,x)&&A(a,w)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(b){typeof console!=t&&a(console,"log")&&console.log(b)}function h(a,b){C&&b?alert(a):g(a)}function i(a){E.initialized=!0,E.supported=!1,h("Rangy is not supported in this environment. Reason: "+a,E.config.alertOnFail)}function j(a){h("Rangy warning: "+a,E.config.alertOnWarn)}function k(a){return a.message||a.description||String(a)}function l(){if(C&&!E.initialized){var b,c=!1,d=!1;a(document,"createRange")&&(b=document.createRange(),y(b,v)&&A(b,u)&&(c=!0));var h=f(document);if(!h||"body"!=h.nodeName.toLowerCase())return void i("No body element found");if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return void i("Neither Range nor TextRange are available");E.initialized=!0,E.features={implementsDomRange:c,implementsTextRange:d};var j,l;for(var m in B)(j=B[m])instanceof n&&j.init(j,E);for(var o=0,p=H.length;p>o;++o)try{H[o](E)}catch(q){l="Rangy init listener threw an exception. Continuing. Detail: "+k(q),g(l)}}}function m(a){a=a||window,l();for(var b=0,c=I.length;c>b;++b)I[b](a)}function n(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function o(a,b,c){var d=new n(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(E,b),b.supported=!0}catch(d){var e="Module '"+a+"' failed to load: "+k(d);g(e),d.stack&&g(d.stack)}}});return B[a]=d,d}function p(){}function q(){}var r="object",s="function",t="undefined",u=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],v=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],w=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],x=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],y=d(a),z=d(b),A=d(c),B={},C=typeof window!=t&&typeof document!=t,D={isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:y,areHostObjects:z,areHostProperties:A,isTextRange:e,getBody:f},E={version:"1.3.0-alpha.20140921",initialized:!1,isBrowser:C,supported:!0,util:D,features:{},modules:B,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==t?!0:rangyAutoInitialize}};E.fail=i,E.warn=j;var F;({}).hasOwnProperty?(D.extend=F=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&F(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},D.createOptions=function(a,b){var c={};return F(c,b),a&&F(c,a),c}):i("hasOwnProperty not supported"),C||i("Rangy can only run in a browser"),function(){var a;if(C){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(d){}}a||(a=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),D.toArray=a}();var G;C&&(a(document,"addEventListener")?G=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?G=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),D.addListener=G);var H=[];E.init=l,E.addInitListener=function(a){E.initialized?a(E):H.push(a)};var I=[];E.addShimListener=function(a){I.push(a)},C&&(E.shim=E.createMissingNativeApi=m),n.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=B[b],!(a&&a instanceof n))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){E.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){E.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},E.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=o(a,c,b);E.initialized&&E.supported&&d.init()},E.createCoreModule=function(a,b,c){o(a,b,c)},E.RangePrototype=p,E.rangePrototype=new p,E.selectionPrototype=new q,E.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==D||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(H(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=D)return a.ownerDocument;if(typeof a.document!=D)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=D)return c.defaultView;if(typeof c.parentWindow!=D)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=D)return a.contentDocument;if(typeof a.contentWindow!=D)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=D)return a.contentWindow;if(typeof a.contentDocument!=D)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&E.isHostMethod(a,"setTimeout")&&E.isHostObject(a,"document")}function t(a,b,c){var d;if(a?E.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){var b;try{return b=a.parentNode,!1}catch(c){return!0}}function x(a){if(!a)return"[No node]";if(I&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a){this.root=a,this._next=a}function A(a){return new z(a)}function B(a,b){this.node=a,this.offset=b}function C(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var D="undefined",E=a.util;E.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),E.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var F=document.createElement("div");E.areHostMethods(F,["insertBefore","appendChild","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),E.isHostProperty(F,"innerHTML")||b.fail("Element is missing innerHTML property");var G=document.createTextNode("test");E.areHostMethods(G,["splitText","deleteData","insertData","appendData","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"])||!E.areHostProperties(G,["data"]))||b.fail("Incomplete Text Node implementation");var H=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},I=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br>",I=w(c),a.features.crashyTextNodes=I}();var J;typeof window.getComputedStyle!=D?J=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=D?J=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found"),z.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},B.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},C.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},C.prototype.toString=function(){return this.message},a.dom={arrayContains:H,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:E.getBody,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:J,fragmentFromNodeChildren:y,createIterator:A,DomPosition:B},a.DOMException=C}),E.createCoreModule("DomRange",["DomUtil"],function(a){function b(a,b){return 3!=a.nodeType&&(O(a,b.startContainer)||O(a,b.endContainer))}function c(a){return a.document||P(a.startContainer)}function d(a){return new K(a.parentNode,N(a))}function e(a){return new K(a.parentNode,N(a)+1)}function f(a,b,c){var d=11==a.nodeType?a.firstChild:a;return M(b)?c==b.length?I.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:R(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function g(a,b,d){if(y(a),y(b),c(b)!=c(a))throw new L("WRONG_DOCUMENT_ERR");var e=Q(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=Q(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return d?0>=e&&f>=0:0>e&&f>0}function h(a){for(var b,d,e,f=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(e=a.getSubtreeIterator(),d.appendChild(h(e)),e.detach()),10==d.nodeType)throw new L("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),i(g,b,c),g.detach(),c.stop)return}else for(d=I.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach()):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach()):a.remove(),10==b.nodeType)throw new L("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(b){if(!(e&&!d.test(b.nodeType)||f&&!c(b))){var h=a.startContainer;if(b!=h||!M(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&M(i)&&0==a.endOffset||g.push(b)}}}),g}function m(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+I.inspectNode(a.startContainer)+":"+a.startOffset+", "+I.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&M(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||M(this.sc)?S(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||M(this.ec)?S(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,U(a,d))return e;e=e.parentNode}return null}}function p(a,b){if(cb(a,b))throw new L("INVALID_NODE_TYPE_ERR")}function q(a,b){if(!U(b,a.nodeType))throw new L("INVALID_NODE_TYPE_ERR")}function r(a,b){if(0>b||b>(M(a)?a.length:a.childNodes.length))throw new L("INDEX_SIZE_ERR")}function s(a,b){if(ab(a,!0)!==ab(b,!0))throw new L("WRONG_DOCUMENT_ERR")}function t(a){if(bb(a,!0))throw new L("NO_MODIFICATION_ALLOWED_ERR")}function u(a,b){if(!a)throw new L(b)}function v(a){return W&&I.isBrokenNode(a)||!U(Y,a.nodeType)&&!ab(a,!0)}function w(a,b){return b<=(M(a)?a.length:a.childNodes.length)}function x(a){return!!a.startContainer&&!!a.endContainer&&!v(a.startContainer)&&!v(a.endContainer)&&w(a.startContainer,a.startOffset)&&w(a.endContainer,a.endOffset)}function y(a){if(!x(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function z(a,b){y(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;M(e)&&f>0&&f<e.length&&R(e,f,b),M(c)&&d>0&&d<c.length&&(c=R(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=N(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function A(a){y(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function B(a){a.START_TO_START=ib,a.START_TO_END=jb,a.END_TO_END=kb,a.END_TO_START=lb,a.NODE_BEFORE=mb,a.NODE_AFTER=nb,a.NODE_BEFORE_AND_AFTER=ob,a.NODE_INSIDE=pb}function C(a){B(a),B(a.prototype)}function D(a,b){return function(){y(this);var c,d,f=this.startContainer,g=this.startOffset,h=this.commonAncestorContainer,j=new n(this,!0);f!==h&&(c=S(f,h,!0),d=e(c),f=d.node,g=d.offset),i(j,t),j.reset();var k=a(j);return j.detach(),b(this,f,g,f,g),k}}function E(c,f){function g(a,b){return function(c){q(c,X),q(V(c),Y);var f=(a?d:e)(c);(b?h:i)(this,f.node,f.offset)}}function h(a,b,c){var d=a.endContainer,e=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((V(b)!=V(d)||1==Q(b,c,d,e))&&(d=b,e=c),f(a,b,c,d,e))}function i(a,b,c){var d=a.startContainer,e=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((V(b)!=V(d)||-1==Q(b,c,d,e))&&(d=b,e=c),f(a,d,e,b,c))}var l=function(){};l.prototype=a.rangePrototype,c.prototype=new l,J.extend(c.prototype,{setStart:function(a,b){p(a,!0),r(a,b),h(this,a,b)},setEnd:function(a,b){p(a,!0),r(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],d=b,e=c;switch(a.length){case 3:e=a[2];break;case 4:d=a[2],e=a[3]}f(this,b,c,d,e)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){y(this),a?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){p(a,!0),f(this,a,0,a,T(a))},selectNode:function(a){p(a,!1),q(a,X);var b=d(a),c=e(a);f(this,b.node,b.offset,c.node,c.offset)},extractContents:D(k,f),deleteContents:D(j,f),canSurroundContents:function(){y(this),t(this.startContainer),t(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},splitBoundaries:function(){z(this)},splitBoundariesPreservingPositions:function(a){z(this,a)},normalizeBoundaries:function(){y(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,d=this.endOffset,e=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,d=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(e){var f=e.previousSibling;if(f&&f.nodeType==e.nodeType){a=e;var g=e.length;if(b=f.length,e.insertData(0,f.data),f.parentNode.removeChild(f),a==c)d+=b,c=a;else if(c==e.parentNode){var h=N(e);d==h?(c=e,d=g):d>h&&d--}}},h=!0;if(M(c))c.length==d&&e(c);else{if(d>0){var i=c.childNodes[d-1];i&&M(i)&&e(i)}h=!this.collapsed}if(h){if(M(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&M(j)&&g(j)}}else a=c,b=d;f(this,a,b,c,d)},collapseToPoint:function(a,b){p(a,!0),r(a,b),this.setStartAndEnd(a,b)}}),C(c)}function F(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:I.getCommonAncestor(a.startContainer,a.endContainer)}function G(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=I.getDocument(b),F(a)}function H(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,F(this)}var I=a.dom,J=a.util,K=I.DomPosition,L=a.DOMException,M=I.isCharacterDataNode,N=I.getNodeIndex,O=I.isOrIsAncestorOf,P=I.getDocument,Q=I.comparePoints,R=I.splitDataNode,S=I.getClosestAncestorIn,T=I.getNodeLength,U=I.arrayContains,V=I.getRootContainer,W=a.features.crashyTextNodes;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,M(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!M(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return b(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new H(c(this.range));var b=this._current,d=b,e=0,f=b,g=T(b);O(b,this.sc)&&(d=this.sc,e=this.so),O(b,this.ec)&&(f=this.ec,g=this.eo),G(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var X=[1,3,4,5,7,8,10],Y=[2,9,11],Z=[5,6,10,12],$=[1,3,4,5,7,8,10,11],_=[1,3,4,5,7,8],ab=o([9,11]),bb=o(Z),cb=o([6,10,12]),db=document.createElement("style"),eb=!1;try{db.innerHTML="<b>x</b>",eb=3==db.firstChild.nodeType}catch(fb){}a.features.htmlParsingConforms=eb;var gb=eb?function(a){var b=this.startContainer,c=P(b);if(!b)throw new L("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:M(b)&&(d=I.parentElement(b)),d=null===d||"HTML"==d.nodeName&&I.isHtmlNamespace(P(d).documentElement)&&I.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,I.fragmentFromNodeChildren(d)}:function(a){var b=c(this),d=b.createElement("body");return d.innerHTML=a,I.fragmentFromNodeChildren(d)},hb=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ib=0,jb=1,kb=2,lb=3,mb=0,nb=1,ob=2,pb=3;J.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){y(this),s(this.startContainer,b.startContainer);var c,d,e,f,g=a==lb||a==ib?"start":"end",h=a==jb||a==ib?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],Q(c,d,e,f)},insertNode:function(a){if(y(this),q(a,$),t(this.startContainer),O(a,this.startContainer))throw new L("HIERARCHY_REQUEST_ERR");var b=f(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){y(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;var d=new n(this,!0);return a=h(d),d.detach(),a},canSurroundContents:function(){y(this),t(this.startContainer),t(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(q(a,_),!this.canSurroundContents())throw new L("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){y(this);for(var a,b=new H(c(this)),d=hb.length;d--;)a=hb[d],b[a]=this[a];return b},toString:function(){y(this);var a=this.startContainer;if(a===this.endContainer&&M(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){y(this);var b=a.parentNode,c=N(a);if(!b)throw new L("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?ob:mb:e>0?nb:pb},comparePoint:function(a,b){return y(this),u(a,"HIERARCHY_REQUEST_ERR"),s(a,this.startContainer),Q(a,b,this.startContainer,this.startOffset)<0?-1:Q(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:gb,toHtml:function(){return A(this)},intersectsNode:function(a,b){if(y(this),u(a,"NOT_FOUND_ERR"),P(a)!==c(this))return!1;var d=a.parentNode,e=N(a);u(d,"NOT_FOUND_ERR");var f=Q(d,e,this.endContainer,this.endOffset),g=Q(d,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return y(this),u(a,"HIERARCHY_REQUEST_ERR"),s(a,this.startContainer),Q(a,b,this.startContainer,this.startOffset)>=0&&Q(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return g(this,a,!1)},intersectsOrTouchesRange:function(a){return g(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=Q(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=Q(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==Q(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==Q(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new L("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==pb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,T(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a)},getNodes:function(a,b){return y(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var d=c(this),e=a.createRange(d);b=b||I.getBody(d),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return H.rangesEqual(this,a)},isValid:function(){return x(this)},inspect:function(){return m(this)},detach:function(){}}),E(H,G),J.extend(H,{rangeProperties:hb,RangeIterator:n,copyComparisonConstants:C,createPrototypeRange:E,inspect:m,toHtml:A,getRangeDocument:c,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=H}),E.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=m.length;c--;)b=m[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var k,l,m=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g),k=c.prototype,k.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},k.cloneContents=function(){return this.nativeRange.cloneContents()},k.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},k.collapse=function(a){this.nativeRange.collapse(a),d(this)},k.cloneRange=function(){return new c(this.nativeRange.cloneRange())},k.refresh=function(){d(this)},k.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),k.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},k.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},l=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(p){k.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},k.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},l=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}k.setStartBefore=l("setStartBefore","setEndBefore"),k.setStartAfter=l("setStartAfter","setEndAfter"),k.setEndBefore=l("setEndBefore","setStartBefore"),k.setEndAfter=l("setEndAfter","setStartAfter"),k.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var q=document.createRange();q.selectNodeContents(n),q.setEnd(n,4),q.setStart(n,2),k.compareBoundaryPoints=-1==o.compareBoundaryPoints(o.START_TO_END,q)&&1==o.compareBoundaryPoints(o.END_TO_START,q)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var r=document.createElement("div");r.innerHTML="123";var s=r.firstChild,t=i(document);t.appendChild(r),o.setStart(s,1),o.setEnd(s,2),o.deleteContents(),"13"==s.data&&(k.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},k.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),t.removeChild(r),t=null,f.isHostMethod(o,"createContextualFragment")&&(k.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),k.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(a){return a("return this;")()
}(Function);"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),E.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=bb.length;e--;)if(c=bb[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(bb.splice(e,1),!0):d;return"deleteAll"==b&&(bb.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);Q?(y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b}):O?(y=e,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=y;var R=y(),S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=g(b),h=0;c>h;++h)e[h]=b.getRangeAt(h);var i=M(document),j=i.appendChild(document.createElement("div"));j.contentEditable="false";var k=j.appendChild(document.createTextNode("   ")),l=document.createRange();if(l.setStart(k,1),l.collapse(!0),b.addRange(l),Y=1==b.rangeCount,b.removeAllRanges(),!d){var m=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(m&&parseInt(m[1])>=36)X=!1;else{var n=l.cloneRange();l.setStart(k,0),n.setEnd(k,3),n.setStart(k,2),b.addRange(l),b.addRange(n),X=2==b.rangeCount}}for(i.removeChild(j),b.removeAllRanges(),h=0;c>h;++h)0==h&&f?Z?Z(b,e[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[h])):b.addRange(e[h])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ab;E(R,"getRangeAt")?ab=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(ab=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var bb=[],cb=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),bb.push({win:a,selection:b})),b};a.getSelection=cb,a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(C.getIframeWindow(c))};var db=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){db.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var eb=function(a,b){Z(a.nativeSelection,b),a.refresh()};db.addRange=W?function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)eb(this,b);else{var e;X?e=this.rangeCount:(this.removeAllRanges(),e=0);var f=k(b).cloneRange();try{this.nativeSelection.addRange(f)}catch(g){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var i=ab(this.nativeSelection,this.rangeCount-1);i&&!N(i,b)&&(b=new G(i))}this._ranges[this.rangeCount-1]=b,h(this,b,hb(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:function(a,b){c(b)&&V?eb(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},db.setRanges=function(a){if(_&&P&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;db.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},db.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},db.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}db.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fb;if(Q)fb=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fb=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],hb(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fb=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=ab(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}db.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fb(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var gb=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};db.removeRange=_&&P?function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else gb(this,a)}:function(a){gb(this,a)};var hb;!Q&&U&&J.implementsDomRange?(hb=g,db.isBackward=function(){return hb(this)}):hb=db.isBackward=function(){return!1},db.isBackwards=db.isBackward,db.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},db.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},db.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},db.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},db.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},db.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},db.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},db.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},db.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},db.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b))}),c},db.setStart=w(!0),db.setEnd=w(!1),a.rangePrototype.select=function(a){cb(this.getDocument()).setSingleRange(this,a)},db.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},db.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},db.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},db.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},db.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(F.toHtml(b))}),a.join("")},J.implementsTextRange&&(db.getNativeTextRange=function(){var c;if(c=this.docSelection){var d=c.createRange();if(n(d))return d;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),db.getName=function(){return"WrappedSelection"},db.inspect=function(){return x(this)},db.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=db,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return cb(a)}),a=null})});var J=!1,K=function(){J||(J=!0,!E.initialized&&E.config.autoInitialize&&l())};return C&&("complete"==document.readyState?K():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",K,!1),G(window,"load",K))),E},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){a.createModule("SaveRestore",["WrappedRange"],function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(p)),f.insertNode(c),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=b.toString();return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:c,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function h(d,f){var g=d.document;"undefined"==typeof f&&(f=!0);var h=a.createRange(g);if(d.collapsed){var i=c(d.markerId,g);if(i){i.style.display="inline";var j=i.previousSibling;j&&3==j.nodeType?(i.parentNode.removeChild(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),i.parentNode.removeChild(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(g,h,d.startMarkerId,!0),e(g,h,d.endMarkerId,!1);return f&&h.normalizeBoundaries(),h}function i(b,d){var e,h,i=[];b=b.slice(0),b.sort(f);for(var j=0,k=b.length;k>j;++j)i[j]=g(b[j],d);for(j=k-1;j>=0;--j)e=b[j],h=a.DomRange.getRangeDocument(e),e.collapsed?e.collapseAfter(c(i[j].markerId,h)):(e.setEndBefore(c(i[j].endMarkerId,h)),e.setStartAfter(c(i[j].startMarkerId,h)));return i}function j(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=i(e,f);return f?d.setSingleRange(e[0],"backward"):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function k(a){for(var b=[],c=a.length,d=c-1;d>=0;d--)b[d]=h(a[d],!0);return b}function l(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length;1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function m(a,b){var d=c(b,a);d&&d.parentNode.removeChild(d)}function n(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?m(a.doc,b.markerId):(m(a.doc,b.startMarkerId),m(a.doc,b.endMarkerId))}var o=a.dom,p="﻿";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})})},this),function(a){a.Arte=a.Arte||{},a.fn.Arte=function(b,c){var d=[];return rangy.init(),this.each(function(){var e=a(this),f=e.data("Arte");if(b&&"string"==typeof b){var g=b;if(this.constructor===a.Arte.TextArea&&(f=this),!f)throw"This is not a rich text field.";var h=f[g].call(f,c);d.push(h)}else f||(b=b||{},b.element=this,f=new a.Arte.TextArea(b),e.data("Arte",f)),d.push(f)}),a(d)}}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.TextArea=function(b){var c=this,d=a.Arte.configuration,e=a.Arte.constants;c.$element=a(b.element),c.element=c.$element.get(0),c._container=c.element;var f=a.extend({},d.initialValues,b),g=e.eventNames;this.editorType=b.editorType||e.editorTypes.richText,this._currentOuterValue="";var h=null,i=function(){var b=c._container.innerHTML,d=c._currentOuterValue;if(b!==d){var e=c.$el.contents();if(a.Arte.dom.hasUnsanctionedElements(e)){var f;k&&(f=rangy.saveSelection()),a.Arte.dom.handleUnsanctionedElements(e),k&&rangy.restoreSelection(f)}c._currentOuterValue=c._container.innerHTML,c.triggerEvent(g.onvaluechange,{newValue:c.value(),src:"internal"})}},j=function(){h||(h=setInterval(i,d.pollIntervalInMs))};if(c.element.hasChildNodes()){if(c.el=c._container.childNodes[0],"DIV"===c.el.tagName)c.el.setAttribute("contenteditable","true");else if("TEXTAREA"!==c.el.tagName)throw new Error("Cannot make element editable");c.$el=a(c.el)}else c.editorType===e.editorTypes.richText?(c.el=document.createElement("div"),c.el.setAttribute("contenteditable","true")):(c.el=document.createElement("textarea"),c.el.style.height="100%",c.el.style.width="100%",c.el.style.padding=0,c.el.style.border=0),c._container.appendChild(c.el),c.$el=a(c.el);c.$el.css(f.styles),c.el.setAttribute("class",f.classes.join(" ")),c._container.setAttribute(d.textFieldIdentifier,"1");var k=!1;c.$el.on({keydown:function(a){c.triggerEvent(g.onkeydown,{originalEvent:a}),a.stopPropagation()},keyup:function(a){c.triggerEvent(g.onkeyup,{originalEvent:a}),a.stopPropagation()},keypress:function(a){c.triggerEvent(g.onkeypress,{originalEvent:a}),a.stopPropagation()},focus:function(a){k||(k=!0,c.triggerEvent(g.onfocus,{originalEvent:a})),j(),a.stopPropagation()},blur:function(a){i(),k=!1,c.triggerEvent(g.onselectionchange),c.triggerEvent(g.onblur,{originalEvent:a}),h&&(clearInterval(h),h=null),a.stopPropagation()},mouseup:function(a){c.triggerEvent(g.onselectionchange),c.triggerEvent(g.onmouseup,{originalEvent:a})},mousedown:function(a){c.triggerEvent(g.onmousedown,{originalEvent:a})},click:function(a){c.triggerEvent(g.onclick,{originalEvent:a})},paste:function(a){setTimeout(function(){c.triggerEvent(g.onpaste,{originalEvent:a})},50)}}),a.Arte.pluginManager.init(c),c.value(f.value),a(c._container).on(b.on),c.triggerEvent(g.oncreate)},a.extend(a.Arte.TextArea.prototype,{value:function(b){var c=a.Arte.constants,d=this.editorType===c.editorTypes.richText?"innerHTML":"value",e=this.el[d];return"undefined"==typeof b?e:void(e!==b&&(this.el[d]=b,this._currentOuterValue=this._container.innerHTML,this.triggerEvent(c.eventNames.onvaluechange,{newValue:b,src:"external"})))},outerValue:function(b){if("undefined"==typeof b){var c=this.$element.clone();return c.children().removeAttr("contenteditable"),c.html()}var d=a(b)[0];this.el.setAttribute("style",d.getAttribute("style")||""),this.el.setAttribute("class",d.getAttribute("class")||""),this.value(d.innerHTML)},focus:function(){var b=this,c=function(){b.$el.off("focus",c),a.Arte.util.moveCursorToEndOfElement(b.$el.get(0)),b.triggerEvent(a.Arte.constants.eventNames.onselectionchange)};b.$el.on("focus",c),b.$el.focus()},triggerEvent:function(b,c){this.$element.trigger(b,a.extend(c,{textArea:this}))},destroy:function(b){this.$element.removeData("Arte"),this.$element.removeAttr(a.Arte.configuration.textFieldIdentifier),this.$element.off(),this.$el.off(),this.$el.removeAttr("contentEditable"),this.triggerEvent(a.Arte.constants.eventNames.ondestroy),b&&b.removeContent&&this.$element.empty()},on:function(a,b){this.$element.on(a,b)},off:function(a,b){this.$element.off(a,b)}})}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.constants={editorTypes:{richText:"richText",plainText:"plainText"},commandType:{inline:"inline",block:"block",complex:"complex",other:"other"},nodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,COMMENT:8},tagName:{LI:"LI",OL:"OL",UL:"UL",BR:"BR",DIV:"DIV",SPAN:"SPAN",P:"P",B:"B",I:"I",U:"U",STRONG:"STRONG",SUB:"SUB",SUP:"SUP",BLOCKQUOTE:"BLOCKQUOTE",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6"},eventNames:{oninput:"oninput",onfocus:"onfocus",onblur:"onblur",onvaluechange:"onvaluechange",onmousedown:"onmousedown",onmouseup:"onmouseup",onclick:"onclick",onkeydown:"onkeydown",onkeypress:"onkeypress",onkeyup:"onkeyup",onpaste:"onpaste",onselectionchange:"onselectionchange",onbeforecommand:"onbeforecommand",oncommand:"oncommand",oncreate:"oncreate",ondestroy:"ondestroy"},commandAttrType:{tagName:"tagName",styleName:"styleName",className:"className",other:"other"}};var b=a.Arte.constants;a.Arte.configuration={requireFocus:!0,classNameSpace:"arte",commandAttrType:b.commandAttrType.styleName,textFieldIdentifier:"rteTextField",rangySelectionBoundaryClassName:"rangySelectionBoundary",defaultInlineTag:b.tagName.SPAN,defaultBlockTag:b.tagName.P,pollIntervalInMs:350,handleUnsanctionedTagsOnGetValue:!0},a.Arte.configuration.initialValues={styles:{"min-height":"200px",height:"inherit"},classes:[],value:"Please enter text ..."};var c=a.Arte.configuration;a.Arte.configuration.commands={bold:{commandType:b.commandType.inline,tagName:b.tagName.B,styleName:"font-weight",classNameRegex:new RegExp(c.classNameSpace+"-font-weight-[\\S]+"),defaultValue:{styleName:"bold",className:c.classNameSpace+"-font-weight-bold"},applierTagName:{tagName:b.tagName.B,className:b.tagName.SPAN,styleName:b.tagName.SPAN},supportsPlainText:!0},italic:{tagName:b.tagName.I,applierTagName:{tagName:b.tagName.I,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"font-style",classNameRegex:new RegExp(c.classNameSpace+"-font-style-italic"),commandType:b.commandType.inline,defaultValue:{styleName:"italic",className:c.classNameSpace+"-font-style-italic"},supportsPlainText:!0},underline:{tagName:b.tagName.U,applierTagName:{tagName:b.tagName.U,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"text-decoration",classNameRegex:new RegExp(c.classNameSpace+"-text-decoration-[\\S]+"),commandType:b.commandType.inline,defaultValue:{styleName:"underline",className:c.classNameSpace+"-text-decoration-underline"},supportsPlainText:!0},blockquote:{tagName:b.tagName.BLOCKQUOTE,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h1:{tagName:b.tagName.H1,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h2:{tagName:b.tagName.H2,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h3:{tagName:b.tagName.H3,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h4:{tagName:b.tagName.H4,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h5:{tagName:b.tagName.H5,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h6:{tagName:b.tagName.H6,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},orderedList:{tagName:b.tagName.OL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},unorderedList:{tagName:b.tagName.UL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},subscript:{tagName:b.tagName.SUB,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},superscript:{tagName:b.tagName.SUP,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},_li:{tagName:b.tagName.LI,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},insert:{tagName:b.tagName.SPAN,commandType:b.commandType.other,commandAttrType:b.commandAttrType.other},fontSize:{styleName:"font-size",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-size-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},fontFamily:{styleName:"font-family",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-family-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},color:{styleName:"color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},backgroundColor:{styleName:"background-color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-background-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},textAlign:{styleName:"text-align",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-text-align-[\\S]+"),applierTagName:b.tagName.P,commandType:b.commandType.block,supportsPlainText:!0}},function(){a.each(c.commands,function(a,b){b.commandName=a})}()}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.pluginManager={plugins:{},register:function(a,b){this.plugins[a]=b},init:function(a){a.pluginInstances=a.pluginInstances||[];for(var b in this.plugins){var c=new this.plugins[b];c.init(a),a.pluginInstances.push(c)}}}}(jQuery),function(){var a=$.Arte.constants,b=$.Arte.configuration,c=a.commandAttrType,d=function(a,d){var e=b.commands[a];if(e.commandAttrType)return e.commandAttrType;var f=b.commandAttrType;return d?(d.commandAttrType?f=d.commandAttrType:d.styleName?f=c.styleName:d.className?f=c.className:d.tagName&&(f=c.tagName),f):f},e=function(b,c){var d=h.call(this,b,c);d.execute=!0,this.triggerEvent(a.eventNames.onbeforecommand,d),d.execute&&(delete d.execute,$.Arte.RichTextCommandApplier.createAndExecute(d),this.triggerEvent(a.eventNames.oncommand,d))},f=function(a,d,e){if(e&&d===c.styleName&&e.styleValue)return e.styleValue;if(e&&d===c.className&&e.className)return e.className;if(e&&e.commandValue)return e.commandValue;if("string"==typeof e)return e;var f=b.commands[a].defaultValue;return f?f[d]:void 0},g=function(c,d,e){if(e&&e.tagName)return e.tagName;var f=b.commands[c];return f.applierTagName?$.isPlainObject(f.applierTagName)?f.applierTagName[d]:f.applierTagName:f.tagName?f.tagName:f.commandType===a.commandType.inline?b.defaultInlineTag:b.defaultBlockTag},h=function(c,e){var h=d(c,e),i=b.commands[c],j={textArea:this,commandAttrType:h,commandName:c,tagName:i.tagName,applierTagName:g(c,h,e)},k=f(c,h,e);switch(h){case a.commandAttrType.className:j.classNameRegex=i.classNameRegex,j.className=k;break;case a.commandAttrType.styleName:j.styleName=i.styleName,j.styleValue=k}return $.extend(e,j)};$.extend($.Arte.TextArea.prototype,{bold:function(a){e.apply(this,["bold",a])},italic:function(a){e.apply(this,["italic",a])},underline:function(a){e.apply(this,["underline",a])},blockquote:function(){e.apply(this,["blockquote"])},h1:function(){e.apply(this,["h1"])},h2:function(){e.apply(this,["h2"])},h3:function(){e.apply(this,["h3"])},h4:function(){e.apply(this,["h4"])},h5:function(){e.apply(this,["h5"])},h6:function(){e.apply(this,["h6"])},subscript:function(){e.apply(this,["subscript"])},superscript:function(){e.apply(this,["superscript"])},fontSize:function(a){e.apply(this,["fontSize",a])},fontFamily:function(a){e.apply(this,["fontFamily",a])},color:function(a){e.apply(this,["color",a])},backgroundColor:function(a){e.apply(this,["backgroundColor",a])},unorderedList:function(a){e.apply(this,["unorderedList",a])},orderedList:function(a){e.apply(this,["orderedList",a])},textAlign:function(a){e.apply(this,["textAlign",a])},toggleStyleOnElement:function(a){var b=a.element||this.$el;if(a&&a.styleName){var c=$.Arte.dom.getStyles(b);a.styleValue===c[a.styleName]&&(a.styleValue=""),b.css(a.styleName,a.styleValue)}if(a&&a.className){var d=b.hasClass(a.className)?"removeClass":"addClass";b[d](a.className)}}})}(),function(a){a.Arte=a.Arte||{},a.Arte.util={isSelectionInElement:function(a){var b=rangy.getSelection(),c=b.getAllRanges()[0];return c&&(c.startContainer===a.get(0)||0!==a.has(c.startContainer).length)},moveCursorToEndOfElement:function(a){var b=new rangy.createRangyRange;b.selectNodeContents(a),b.collapse();var c=rangy.getSelection();c.setSingleRange(b)},all:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!!d}),d},any:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!d}),d},filterCollection:function(b,c){var d=[];return a.each(b,function(a,e){c(a,e)&&d.push(b.length?e:a)}),d},getSelectedTextNodes:function(b){var c,d=a(),e=rangy.getSelection(),f=a.Arte.util.isSelectionInElement(this.$el);if(e.isCollapsed||!f){if(b&&f)return c=e.getRangeAt(0),d.push(c.startContainer),d;c=rangy.createRangyRange(),c.selectNodeContents(this.$el.get(0)),d=rangy.util.getTextNodes(c)}else f&&(c=e.getAllRanges()[0],d=rangy.util.getTextNodes(c));return d},getCommandConfig:function(b){var c=null,d=null,e=a.Arte.configuration,f=a.Arte.constants,g=function(a,c){return c===b.tagName};if(b&&b.commandName)return e.commands[b.commandName];for(var h in e.commands){var i=e.commands[h];if(b.className&&i.classNameRegex&&i.classNameRegex.test(b.className)?(c=i,d=f.commandAttrType.className):b.styleName&&b.styleName===i.styleName?(c=i,d=f.commandAttrType.styleName):!b.tagName||b.className||b.styleName||(a.isPlainObject(i.tagName)?a.Arte.util.any(i.tagName,g)&&(c=i):b.tagName===i.tagName&&(c=i),d=f.commandAttrType.tagName),c)return a.extend({commandAttrType:d},c)}return null}}}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b=a.Arte.dom,c=a.Arte.configuration,d=a.Arte.constants,e=a.Arte.util;a.extend(c,{styleableTags:{SPAN:1,DIV:1,P:1,LI:1,UL:1,OL:1},supportedTags:{P:1,UL:1,OL:1,LI:1,SPAN:1,BR:1}}),a.extend(c,{cleanup:{options:{removeNonPrintableCharacters:!0,removeEmptyElements:!0,removeRedundantMarkup:!0,mergeAdjacentLists:!0},invalidTagHandlers:{B:{applierTagName:"span",styleName:"font-weight",styleValue:"bold"},I:{applierTagName:"span",styleName:"font-style",styleValue:"italic"},U:{applierTagName:"span",styleName:"text-decoration",styleValue:"underline"},DIV:{applierTagName:"P"}},mergableTags:{SPAN:{SPAN:1,DIV:1,P:1,LI:1},DIV:{DIV:1,P:1,LI:1},P:{DIV:1,P:1,LI:1},LI:{},OL:{},UL:{},B:{B:1},U:{U:1},I:{I:1},STRONG:{STRONG:1},SUB:{SUB:1},SUP:{SUP:1},H1:{H2:1,H3:1,H4:1,H5:1,H6:1},H2:{H1:1,H3:1,H4:1,H5:1,H6:1},H3:{H1:1,H2:1,H4:1,H5:1,H6:1},H4:{H1:1,H2:1,H3:1,H5:1,H6:1},H5:{H1:1,H2:1,H3:1,H4:1,H6:1},H6:{H1:1,H2:1,H3:1,H4:1,H5:1}},invalidCharacterRegex:["\x00-","-"," -‏","-"]}});var f,g=c.cleanup,h=function(c,d){for(var e=function(b,c){return!a(c).is(":emptyTextOrRangySpan")
};d.length;){var f=a(d[d.length-1]);d.splice(d.length-1,1);var g=b.prevSiblingIncludingTextNodes(f,e);g&&g.prop("tagName")===c&&(f.children().appendTo(g),f.remove())}},i=function(b){b.each(function(){h(d.tagName.OL,a(this).find(d.tagName.OL)),h(d.tagName.UL,a(this).find(d.tagName.UL))})},j={Next:0,Prev:1},k=function(c,d,e){var f=a(),g=d==j.Next?"nextSiblingIncludingTextNodes":"prevSiblingIncludingTextNodes",h=b[g](c,e);return h.length&&h.is(":element")&&!h.is(":block")&&c.prop("tagName")===h.prop("tagName")&&b.hasSameStyleAndClass(c,h)&&f.push(h[0]),f},l=function(a,b){return k(a,j.Prev,b)},m=function(b){return b.contents().filter(function(b,c){return!a(c).is(":emptyTextOrRangySpan")})},n=function(d,f){var g=m(d);if(!c.styleableTags[d.prop("tagName")])return!1;var h=g.filter(function(){return a(this).is(":element")});h.each(function(){var c=a(this),h=b.getStyles(c),i=b.getClasses(c);1===g.length?(a.each(h,function(a,b){d.css(a,b),c.css(a,"")}),a.each(i,function(a,c){var f=e.getCommandConfig({className:c});f&&f.classNameRegex&&b.removeClassWithPattern(d,f.classNameRegex),d.addClass(c),g.removeClass(c)})):(a.each(h,function(a,c){var h=e.getCommandConfig({styleName:a}),i={commandName:h.commandName,styleName:a,styleValue:c,topEditableParent:f.topEditableParent};b.closestWithCommandValue(g,i).length===g.length&&(d.css(a,c),g.css(a,""))}),a.each(i,function(a,c){if(b.allHaveClass(g,c)){var f=e.getCommandConfig({className:c});f.classNameRegex&&b.removeClassWithPattern(d,f.classNameRegex),d.addClass(c),g.removeClass(c)}}))})},o=function(b){for(var c=m(b),d=1;d<c.length;d++){var e=a(c[d]);if(e.is(":element")&&!e.is(":block")){var f=l(e);f.get(0)&&(f.append(e.contents()),e.remove())}}},p=function(c,d){var f=m(c),h=f.filter(function(){var b=a(this),d=g.mergableTags[b.prop("tagName")];return b.is(":element")&&(!b.is(":block")||1===f.length)&&d&&d[c.prop("tagName")]});h.each(function(){var c=a(this),f=b.getStyles(c),g=b.getClasses(c),h=e.all(f,function(a,d){var f=e.getCommandConfig({styleName:a}),g=b.closestWithCommand(c.parent(),{commandName:f.commandName,styleName:a});return g.get(0)&&b.getStyles(g)[a]===d}),i=c.parentsUntil(d.topEditableParent.parentNode),j=e.all(g,function(a,b){return i.hasClass(b)});return h&&j?void c.contents().first().unwrap():void 0})},q=function(c,d){var f=m(c),g=b.getStyles(c);a.each(g,function(g,h){var i=e.all(f,function(c,d){return b.getStyles(a(d))[g]})||b.closestWithCommandValue(c.parent(),{styleName:g,styleValue:h,topEditableParent:d.topEditableParent}).length>0;i&&c.css(g,"")});var h=b.getClasses(c);a.each(h,function(d,g){var h=e.getCommandConfig({className:g}),i=h&&h.classNameRegex&&e.all(f,function(c,d){return b.hasClassWithPattern(a(d),h.classNameRegex)})||c.parents().hasClass(g);i&&c.removeClass(g)})},r=function(b,c){b.each(function(){var b=a(this);if(b.is(":element")){var d=m(b);r(d,c),n(b,c),q(b,c),o(b,c),p(b,c)}})},s=function(a){var c=a.parent();a.is(":block")&&b.nextSiblingIncludingTextNodes(a).length&&b.prevSiblingIncludingTextNodes(a).length&&a.before("<br />"),a.remove(),c.is(":empty")&&s(c)},t=function(b){var c=b.find(":empty").not("br").not(":rangySpan");c.each(function(){s(a(this))})},u=function(b){b.find("."+c.rangySelectionBoundaryClassName).each(function(){1===a(this).parent().contents().length&&a(this).unwrap()})},v=function(a){var b=a.topEditableParent.innerHTML;f=f||new RegExp("["+g.invalidCharacterRegex.join("")+"]","g"),a.topEditableParent.innerHTML=b.replace(f,"")},w=function(c,d){d=a.extend({},g.options,d),d.topEditableParent||(d.topEditableParent=b.getTopEditableParent(c).get(0)),u(c),d.removeNonPrintableCharacters&&v(d),d.removeEmptyElements&&t(c),d.mergeAdjacentLists&&i(c),d.removeRedundantMarkup&&r(c,d)},x=function(b){for(var d=0;d<b.length;d++){var e=b[d];if(e.nodeType!=a.Arte.constants.nodeType.TEXT){if(!c.supportedTags[e.tagName])return!0;if(x(a(e).contents()))return!0}}return!1},y=function(b){b.each(function(){if(this.nodeType!=a.Arte.constants.nodeType.TEXT){var b=a(this);y(b.contents());var d=this.tagName;if(!c.supportedTags[d]){var e=g.invalidTagHandlers[d]||{tagName:"P"},f=a.Arte.dom.createContainer(e).html(b.html());b.replaceWith(f)}}})};b.hasUnsanctionedElements=x,b.handleUnsanctionedElements=y,b.cleanup=w}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b=a.Arte.dom,c=a.Arte.configuration,d=a.Arte.constants;a.extend(b,{wrapWithOptions:function(d,e){var f=a();if(d.length>0){f=b.createContainer(e);var g=b.prevSiblingIncludingTextNodes(d.first());g.hasClass(c.rangySelectionBoundaryClassName)&&f.append(g);var h=b.nextSiblingIncludingTextNodes(d.last());d.first().before(f),d.each(function(){f.append(this)}),h.hasClass(c.rangySelectionBoundaryClassName)&&f.append(h)}return f},unwrapWithOptions:function(c,d){var e=a();return c.each(function(){var c=a(this),f=function(b,c){return!a(c).is(":emptyTextOrRangySpan")};if(c.is(":block")){var g=b.prevSiblingIncludingTextNodes(c,f);g.length&&!g.is(":block")&&d&&d.insertBr&&c.before(a("<br />"));var h=b.nextSiblingIncludingTextNodes(c,f);h.length&&!h.is(":block")&&d&&d.insertBr&&c.after(a("<br />"))}var i=a(this).contents();if(d&&d.maintainStyles){var j=b.wrapWithOptions(i,{applierTagName:"span",attr:{style:c.attr("style")}});j.unwrap(),e=e.add(j)}else i.first().unwrap(),e=e.add(i)}),e},wrapWithBlock:function(a,e){var f,g=b.closestWithAtMostOneBlockChild(a,e.topEditableParent),h=g.prop("tagName");g.first().is(":block")&&e.applierTagName!==d.tagName.LI&&c.styleableTags[h]?h===e.applierTagName||c.styleableTags[h]&&c.styleableTags[e.applierTagName]?e.styleName?g.css(e.styleName,e.styleValue):e.className?g.addClass(e.className):f=g:f=a:f=g;var i=f?b.wrapWithOptions(f,e):g,j=i.next();return j.length&&j.prop("tagName")==d.tagName.BR&&j.remove(),i},unwrapBlock:function(c,d){var e=b.closestWithCommand(c,d);return e.length?!a.isEmptyObject(b.getStyles(e))||b.getClasses(e).length>0||e.attr("contentEditable")?d.styleName?e.css(d.styleName,""):d.className?e.removeClass(d.className):void 0:b.unwrapWithOptions(e,{insertBr:!0}):c},createContainer:function(b){var c=b.applierTagName||"div",d=a("<"+c+">");return b.attr&&d.attr(b.attr),b.styleName&&b.styleValue&&d.css(b.styleName,b.styleValue),b.className&&d.addClass(b.className),d}})}(jQuery),function(a){function b(b,c,d){var e=a(),f=c===g.Next;return b.each(function(){for(var b,c=a(this).parent().contents().get(),g=a.inArray(a(this).get(0),c),h=f?1:-1,i=g+h;f?i<c.length:i>=0;i+=h){var j=d?d(i,c[i]):!0;if(j){b=c[i];break}}b&&e.push(b)}),e}a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var c=a.Arte.dom,d=a.Arte.constants,e=a.Arte.configuration,f=a.Arte.util;a.extend(a.expr[":"],{block:function(b){return 3!==b.nodeType&&(b&&"BR"===b.tagName||("block"===a(b).css("display")||"list-item"===a(b).css("display"))&&"none"===a(b).css("float"))},element:function(a){return a.nodeType===d.nodeType.ELEMENT},emptyText:function(a){return 3===a.nodeType&&null!==a.nodeValue.match(/^\s*$/gi)},rangySpan:function(b){return a(b).hasClass(e.rangySelectionBoundaryClassName)},emptyTextOrRangySpan:function(b){var c=a(b);return c.is(":emptyText")||c.is(":rangySpan")},blockChildren:function(b){return a(b).children().not(this).filter(":block").length>0}});var g={Next:0,Prev:1};document.documentElement.contains&&(jQuery.contains=function(a,b){if(a===b)return!1;if(3===a.nodeType)return!1;var c=b.parentNode||{};return a===c||(1===c.nodeType?!a.contains||a.contains(c):a!==b&&a.contains?a.contains(b):!0)}),a.extend(c,{closestWithAtMostOneBlockChild:function(b,c){var d=[];return b.each(function(){var b=null;a(this).parentsUntil(c).each(function(){var c=a(this).children(":block").length,d=0===c||1===c&&c===this.childNodes.length;return d&&(b=this),d});var e=b||this;-1===a.inArray(e,d)&&d.push(e)}),a(d)},prevSiblingIncludingTextNodes:function(a,c){return b(a,g.Prev,c)},nextSiblingIncludingTextNodes:function(a,c){return b(a,g.Next,c)},getClasses:function(a){var b=[],c=a.attr("class");return c&&(b=c.split(/\s+/)),b},getStyles:function(b){var c={};if(b.prop("nodeType")===d.nodeType.TEXT)return c;var e=b.attr("style"),f=e?e.toLowerCase().split(";"):[];return a.each(f,function(b,d){if(d=a.trim(d),!d)return!0;var e=d.indexOf(":"),f=a.trim(d.substring(0,e)),g=a.trim(d.substring(e+1));g&&(c[f]=g)}),c},hasCommandApplied:function(b,f){var g=!1,h=e.commands[f];return b.each(function(){var b=a(this);if(this.nodeType===d.nodeType.TEXT)return g=!1;var e=c.getStyles(b);return g=h.classNameRegex&&c.hasClassWithPattern(b,h.classNameRegex)||h.styleName&&e[h.styleName]||h.tagName&&this.tagName===h.tagName}),g},hasCommandValue:function(b,d){var e=!1;return b.each(function(){var b=a(this);return e=d.className&&b.hasClass(d.className)||d.styleName&&c.getStyles(b)[d.styleName]===d.styleValue||d.tagName&&b.prop("tagName")===d.tagName}),e},getCommandValue:function(b,d){var f={},g=e.commands[d.commandName];return b.each(function(){var b=a(this),e=c.getStyles(b);return d.className&&b.hasClass(d.className)?f.className=d.className:c.hasClassWithPattern(b,g.classNameRegex)?f.className=c.getClassWithPattern(b,g.classNameRegex)[0]:d.styleName&&e[d.styleName]?f.styleName=e[d.styleName]:d.tagName&&b.prop("tagName")===g.tagName&&(f.tagName=b.prop("tagName")),f}),f},hasClassWithPattern:function(a,b){return b.test(a.attr("class"))},getClassWithPattern:function(a,b){return b.exec(a.attr("class"))},removeClassWithPattern:function(b,d){var e=c.getClassWithPattern(b,d)||[];a.each(e,function(a,c){b.removeClass(c)})},hasSameListParent:function(a){var b=a.first().closest(d.tagName.LI).parent();if(0===b.length)return!1;var c=!0;return a.each(function(){return c=0!==b.has(this).length}),c},allHaveClass:function(b,c){var d=!0;return b.each(function(){return d=a(this).hasClass(c)}),d},hasSameClass:function(b,d){var e={},g={};return a.each(c.getClasses(b),function(){e[this]=1}),a.each(c.getClasses(d),function(){g[this]=1}),f.all(e,function(a){return g[a]})&&f.all(g,function(a){return e[a]})},hasSameStyle:function(a,b){var d=c.getStyles(a),e=c.getStyles(b);return f.all(d,function(a,b){return e[a]===b})&&f.all(e,function(a,b){return d[a]===b})},hasSameStyleAndClass:function(a,b){return c.hasSameStyle(a,b)&&c.hasSameClass(a,b)},closestWithCommandValue:function(b,d){return c.closestWithCommand(b,a.extend(d,{checkValue:1}))},closestWithCommand:function(b,d){var e=a(),g=f.getCommandConfig(d);return g?(b.each(function(){var b=a(this),f=d.topEditableParent||c.getTopEditableParent(b).get(0);if(f){var h=b.parentsUntil(f.parentNode);h.splice(0,0,this),h.each(function(){return c.hasCommandApplied(a(this),g.commandName)?((!d.checkValue||c.hasCommandValue(a(this),d))&&e.push(this),!1):!0})}}),e):e},getTopEditableParent:function(a){var b=a.closest("[contenteditable=true]");return b.length?b:a.closest("textarea")},listSurrounded:function(b,c){var e=f.all(b,function(b,c){return a(c).closest(d.tagName.LI).parents("[contenteditable=true]").get(0)});if(e){var g=b.closest(d.tagName.LI).parent();if(c&&c.singleList&&g.length>1)return!1;if(c&&c.tagName){var h=!1;return g.each(function(a,b){return h=b.tagName===c.tagName}),h}return!0}return!1},isEqual:function(b,c){if(!b.get(0)||!c.get(0))return!1;var d=!0,e=["style","id","class"];if(b.prop("tagName")===c.prop("tagName")){if(a.each(e,function(e,f){if("style"===f)d=a.Arte.dom.hasSameStyle(b,c);else if("class"===f)d=a.Arte.dom.hasSameClass(b,c);else{var g=b.attr(f)&&a.trim(b.attr(f)),h=c.attr(f)&&a.trim(c.attr(f));d=g===h}return d}),d){var f=function(b,c){return!a(c).is(":emptyText")},g=b.contents().filter(f),h=c.contents().filter(f);d=g.length===h.length;for(var i=0,j=g.length;j>i&&d;i++)d=3===g[i].nodeType?a.trim(g[i].nodeValue)===a.trim(h[i].nodeValue):a.Arte.dom.isEqual(a(g[i]),a(h[i]))}}else d=!1;return d}})}(jQuery),rangy.createModule("BlockElementApplier",["WrappedSelection","WrappedRange"],function(a){function b(a,b){for(var c,d=a.length,f=new p,g=e(a),h=0;d>h;h++)c=n.closestWithCommandValue(g[h],b).length>0?f.surroundedIndexes:f.unSurroundedIndexes,c.push(h);return f}function c(a,c){var d=b(a,{tagName:o.tagName.LI,commandAttrType:c.commandAttrType,topEditableParent:c.topEditableParent});if(d.state()===d.Surrounded){var e=$();if($.each(a,function(a,b){var c=$(rangy.util.getTopNodes(b.getNodes())).closest(o.tagName.LI);e.push(c.get(0))}),n.hasSameListParent(e)){var f=e.first().parent();f.prop("tagName")!==c.applierTagName.toUpperCase()&&d.state(d.UnSurrounded)}else d.state(d.Mixed)}return d}function d(a,b){var c=a.children(),d=$(),e=$(),f=$(),g=d;return c.each(function(){return b.originalRange.intersectsNode(this)?(g=f,e.push(this),!0):(g.push(this),!0)}),{tagName:a.prop("tagName"),beforeSelection:d,selection:e,afterSelection:f}}function e(a){for(var b={},c=function(){b[d].push(this)},d=0;d<a.length;d++)b[d]=$(),$(rangy.util.getTopNodes(a[d].getNodes())).each(c);return b}function f(a,b){var c,e=b.blockSurroundState,f=function(a){var b=n.wrapWithBlock;b(a.beforeSelection,{applierTagName:a.tagName}),b(a.afterSelection,{applierTagName:a.tagName})},g=function(a){var c=a.closest(o.tagName.LI).parent(),e=d(c,b);return{parent:c,selectionResult:e}};0===e.surroundedIndexes[0]&&(c=g($(a[0].startContainer)));var h,i=a.length;e.surroundedIndexes[e.surroundedIndexes.length-1]===i-1&&(h=g($(a[i-1].startContainer))),c&&(n.unwrapWithOptions(c.parent),f(c.selectionResult)),!h||c&&c.parent[0]===h.parent[0]||(n.unwrapWithOptions(h.parent),f(h.selectionResult))}function g(a,b){var c=b.blockSurroundState,d=e(a),g=$();f(a,b);var h={};$.each(c.surroundedIndexes,function(){h[this]=1});for(var i=function(){g.push(this)},j=a.length,k=0;j>k;k++){var l;if(h[k]){var m=d[k].first().closest(o.tagName.LI);if(!m.parents(o.tagName.OL)[0]&&!m.parents(o.tagName.UL)[0]){g.push(m[0]);continue}m.parent().children().each(i),n.unwrapWithOptions(m.parent())}else{if(3==d[k][0].nodeType&&65279==d[k][0].nodeValue.charCodeAt(0))continue;l=n.wrapWithBlock(d[k],{applierTagName:o.tagName.LI,topEditableParent:b.topEditableParent}),g.push(l[0])}}n.wrapWithOptions(g,b)}function h(a,b){var c=$(a[0].startContainer).closest(o.tagName.LI).parent(),e=c.prop("tagName"),f=d(c,b);n.unwrapWithOptions(c),n.wrapWithOptions(f.beforeSelection,{applierTagName:e}),n.unwrapWithOptions(f.selection,{insertBr:!0,maintainStyles:!0}),n.wrapWithOptions(f.afterSelection,{applierTagName:e})}function i(a,b){if(!b)return a;var c=rangy.createRangyRange();c.selectNodeContents(b);for(var d=c.splitByBlock(),e=a.cloneRange(),f=0,g=d.length;g>f;f++)e.intersectsRange(d[f])&&(0===d[f].comparePoint(e.startContainer,e.startOffset)&&e.setStart(d[f].startContainer,d[f].startOffset),0===d[f].comparePoint(e.endContainer,e.endOffset)&&e.setEnd(d[f].endContainer,d[f].endOffset));return e}function j(a,b){var d=new $.Arte.ElementApplierOptions(b),e=i(a,b.topEditableParent);d.originalRange=e;var f=e.splitByBlock(),j=c(f,d);d.blockSurroundState=j,j.state()===j.UnSurrounded||j.state()===j.Mixed?g(f,d):j.state()===j.Surrounded&&h(f,d)}function k(a,b){var c=new $.Arte.ElementApplierOptions(a,b),d=rangy.getSelection(),e=d.getRangeAt(0);e&&j(e,c)}function l(a,c){if(!a.isCollapsed){var d=new $.Arte.ElementApplierOptions(c),f=i(a,c.topEditableParent),g=f.splitByBlock(),h=b(g,d),j=e(g);for(var k in j){var l=j[k];h.state()==h.Surrounded?n.unwrapBlock(l,d):n.wrapWithBlock(j[k],d)}}}function m(a,b){var c=new $.Arte.ElementApplierOptions(a,b),d=rangy.getSelection(),e=d.getRangeAt(0);e&&l(e,c)}var n=$.Arte.dom,o=$.Arte.constants,p=function(){this.Surrounded=0,this.UnSurrounded=1,this.Mixed=2,this.Invalid=3,this.surroundedIndexes=[],this.unSurroundedIndexes=[],this._state="",this.computeState=function(){return this._state=this.surroundedIndexes.length&&!this.unSurroundedIndexes.length?this.Surrounded:this.unSurroundedIndexes.length&&!this.surroundedIndexes.length?this.UnSurrounded:this.surroundedIndexes.length&&this.unSurroundedIndexes.length?this.Mixed:this.Invalid,this._state},this.state=function(a){return a&&(this._state=a),this._state||(this._state=this.computeState()),this._state}};a.toggleSurroundRange=l,a.toggleSurroundSelection=m,a.toggleSurroundRangeSet=j,a.toggleSurroundSelectionSet=k}),function(a){a.Arte=a.Arte||{},a.Arte.ElementApplierOptions=function(b){if(b._isProcessed)return b;var c=a.Arte.constants;switch(this.tagName="",this.topEditableParent="",this.commandName="",this.commandAttrType=b.commandAttrType,this.textArea=null,this.commandAttrType){case c.commandAttrType.className:this.classNameRegex="",this.className="";break;case c.commandAttrType.styleName:this.styleName="",this.styleValue=""}for(var d in b)this[d]=b[d];if(this.tagName&&(this.tagName=a("<"+this.tagName+">").prop("tagName")),this.attr={},this.commandAttrType==c.commandAttrType.className&&(this.attr["class"]=this.className),this.commandAttrType==c.commandAttrType.styleName){var e=a("<div>").css(this.styleName,this.styleValue);this.attr.style=e[0].style.cssText}if(!this.commandName){var f=a.Arte.util.getCommandConfig(this);f&&(this.commandName=f.commandName,this.commandAttrType=f.commandAttrType)}this._isProcessed=!0}}(jQuery),$(document).ready(function(){function a(a){var c=a.rangeInfos[0];if(c.collapsed)return null;var d=$("#"+c.startMarkerId)[0],e=$("#"+c.endMarkerId)[0];return b(d,e)}function b(a,b,c){var d=rangy.createRangyRange(),e=c?"setStartAfter":"setStartBefore",f=c?"setEndBefore":"setEndAfter";return d[e](a),d[f](b),d}function c(a){return a.collapsed?void 0:$(a.getNodes([3])).filter(function(){return!g(this)})}rangy.init(),rangy.rangePrototype.splitByBlock=function(){var a=[],b=this.cloneRange();if(b.collapsed)return b;for(var c,d=b.getNodes([3,1],function(a){return i(a)||3===a.nodeType&&!g(a)}),e=null;d.length>0;)if(1!==d[0].nodeType)if(e&&!$(e).has(d[0]).length&&(e=null),d[0].parentNode.childNodes.length>1||!i(f(d[0]))){c=rangy.createRangyRange(),c.setStartBefore(d[0]);for(var h=0,j=d.length;j>h;h++)if(1!==d[h].nodeType){if(i(d[h].nextSibling)||!d[h].nextSibling&&i(d[h].parentNode)||d[h+1]&&i(d[h+1])){c.setEndAfter(d[h]);break}if(e&&!$(e).has(d[h+1]).length){c.setEndAfter(d[h]);break}}c.startContainer===c.endContainer&&c.startOffset===c.endOffset&&(h--,c.setEndAfter(d[h])),a.push(c),d.splice(0,h+1)}else i(f(d[0]))&&(c=rangy.createRangyRange(),c.selectNodeContents(d[0]),a.push(c),d.splice(0,1));else e&&$(e).has(d[0]).length||(e=d[0]),d.splice(0,1);return a};var d,e=function(a){for(var b=[],c=0,d=a.length;d>c;c++){for(var e=!1,f=0,g=a.length;g>f;f++)if($.contains(a[f],a[c])){e=!0;break}e||b.push(a[c])}return b},f=function(a){return 1===a.parentNode.childNodes.length?f(a.parentNode):a},g=function(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b||"﻿"===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;var e=d(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(e)||/^[\t\r ]+$/.test(b)&&"pre-line"==e};if("undefined"!=typeof window.getComputedStyle)d=function(a,b){return rangy.dom.getWindow(a).getComputedStyle(a,null)[b]};else{if("undefined"==typeof document.documentElement.currentStyle)throw new Error("Can't create getComputedStyleProperty");d=function(a,b){return a.currentStyle[b]}}var h=/^(none|inline(-block|-table)?)$/i,i=function(a){if(!a)return!1;var b=a.nodeType;return 1==b&&(!h.test(d(a,"display"))||"BR"===a.tagName)||9==b||11==b};rangy.util.getRangeFromSavedSelection=a,rangy.util.createRangeFromElements=b,rangy.util.getTextNodes=c,rangy.util.isWhitespaceNode=g,rangy.util.isBlockOrLineBreak=i,rangy.util.getTopNodes=e,rangy.util.getTopParentWithSingleChild=f}),rangy.createModule("InlineElementApplier",["WrappedSelection","WrappedRange"],function(a){function b(){return!$(this).hasClass("rangySelectionBoundary")}function c(a,b){var c=rangy.util.getTextNodes(a);return j.closestWithCommandValue(c,b).length===c.length}function d(a,c){var d=a.parent(),e=d.contents().filter(b);if(e.length>1||!k.styleableTags[d.prop("tagName")]||c.commandAttrType===l.commandAttrType.tagName)j.wrapWithOptions(a,c);else if(c.commandAttrType===l.commandAttrType.styleName)d.css(c.styleName,c.styleValue);else if(c.commandAttrType===l.commandAttrType.className){var f=m.getCommandConfig({className:c.className});f&&f.classNameRegex&&j.removeClassWithPattern(d,f.classNameRegex),d.addClass(c.className)}}function e(a,b){rangy.util.getTextNodes(a).each(function(){d($(this),b)})}function f(a,b){var c=j.closestWithCommand(a,$.extend(b,{checkValue:!0})),d=rangy.createRangyRange();d.selectNodeContents(c[0]);var e=m.filterCollection(rangy.util.getTextNodes(d,!0),function(b,c){return c!==a.get(0)});if($.each(e,function(a,c){j.wrapWithOptions($(c),b)}),b.styleName&&j.hasCommandValue(c,{styleName:b.styleName,styleValue:b.styleValue})){var f=new RegExp(b.styleName+"\\s?:\\s?"+b.styleValue+"\\s?;?","i");c[0].style.cssText=c[0].style.cssText.replace(f,"")}else b.className&&j.hasCommandValue(c,{className:b.className})?c.removeClass(b.className):j.unwrapWithOptions(c,b)}function g(a,b){rangy.util.getTextNodes(a).each(function(){f($(this),b)})}function h(a,b){if(a.collapsed)return a;var d=new $.Arte.ElementApplierOptions(b),f=c(a,d);f?g(a,d):e(a,d)}function i(a){var b=new $.Arte.ElementApplierOptions(a),c=rangy.getSelection();if(!c.isCollapsed){var d=rangy.saveSelection(),e=d.rangeInfos[0],f=$("#"+e.startMarkerId),g=$("#"+e.endMarkerId),i=rangy.util.createRangeFromElements(f.get(0),g.get(0),!0);c.setSingleRange(i),f.remove(),g.remove()}var j=rangy.getSelection().getRangeAt(0);j&&h(j,b)}var j=$.Arte.dom,k=$.Arte.configuration,l=$.Arte.constants,m=$.Arte.util;a.toggleStyleOnRange=h,a.toggleStyleOnSelection=i}),function(a){a.Arte=a.Arte||{},a.Arte.RichTextCommandApplier=function(b){var c=a.Arte.dom,d=a.Arte.util,e=a.Arte.constants,f=a.Arte.configuration,g=function(b,f){var g=rangy.getSelection(),h=b.textArea,i=d.isSelectionInElement(h.$el),j=null;if(g.isCollapsed){var k,l=g.getAllRanges()[0];l&&i?(k=l.startContainer,k=k.nodeType===e.nodeType.TEXT?k.parentNode:k):k=h.$el.get(0),j=rangy.util.createRangeFromElements(k,k)}var m=h.$el,n=m.get(0),o={topEditableParent:n};a.extend(o,b);var p=e.commandType,q=null;switch(f){case p.inline:q=function(){return j?rangy.toggleStyleOnRange(j,o):rangy.toggleStyleOnSelection(o)};break;case p.block:q=function(){return j?rangy.toggleSurroundRange(j,o):rangy.toggleSurroundSelection(o,n)};break;case p.complex:q=function(){return j?rangy.toggleSurroundRangeSet(j,o):rangy.toggleSurroundSelectionSet(o,n)}}var r=rangy.saveSelection();q(),c.cleanup(a(o.topEditableParent)),rangy.restoreSelection(r)},h=function(a,b){var c=a.textArea,h=e.editorTypes,i=c.editorType===h.plainText||!c.$el.html(),j=d.isSelectionInElement(c.$el);(j||!f.requireFocus)&&(j||f.requireFocus||"tagName"==a.commandAttrType||(i=!0),i?c.toggleStyleOnElement(a):g(a,b))};this.execute=function(){if(!b.commandName)throw"commandName not specified.";var a=f.commands[b.commandName];if(!a)throw"unrecognized command: "+b.commandName;h(b,a.commandType)}},a.Arte.RichTextCommandApplier.createAndExecute=function(b){var c=new a.Arte.RichTextCommandApplier(b);return c.execute(),c}}(jQuery),function(a){var b=function(){var a={insert:function(a){if($.extend(a,{execute:!0}),this.triggerEvent($.Arte.constants.eventNames.onbeforeinsert,a),a.execute){var b=$.Arte.util.isSelectionInElement(this.$el);if(b||!$.Arte.configuration.requireFocus){var c,d=$("<span>").html(a.commandValue).get(0);if(b){c=rangy.getSelection();var e=c.getAllRanges()[0];c.isCollapsed||e.deleteContents(),e.collapse(),e.insertNode(d)}else this.$el.append(d);c=rangy.getSelection(),c.setSingleRange(rangy.util.createRangeFromElements(d,d)),this.triggerEvent($.Arte.constants.eventNames.onafterinsert,a)}}}};return $.extend($.Arte.TextArea.prototype,a),$.extend($.Arte.constants.eventNames,{onbeforeinsert:"onbeforeinsert",onafterinsert:"onafterinsert"}),{init:function(){}}};a.register("insertCommand",b)}($.Arte.pluginManager),function(a){var b=$.Arte.constants,c=function(a,b){var c=null,d=!0,e=$.Arte.dom.closestWithCommand(a,b);if(a.length!==e.length)return null;var f=$.Arte.dom.getCommandValue(e.first(),b);if(e.each(function(){return d=$.Arte.dom.hasCommandValue($(this),f)}),d)for(var g in f)c=f[g];return c},d=function(a,c){var d=c.tagName;if(d&&(d===b.tagName.OL||d===b.tagName.UL))return $.Arte.dom.listSurrounded(a,{singleList:!0,tagName:d});var e=$.Arte.dom.closestWithCommandValue(a,c);return e.length===a.length},e=function(a,b,e){if(!a||!a.length)return null;var f=$.Arte.configuration.commands[b],g=$.extend({commandName:b,tagName:f.tagName,styleName:f.styleName,styleValue:f.defaultValue?f.defaultValue.styleName:null,className:f.defaultValue?f.defaultValue.className:null},e);return f.acceptsParams?c(a,g):d(a,g)},f=function(a,c){if(c)return e(a,c);var d={};return $.each($.Arte.configuration.commands,function(c,f){$.isPlainObject(f)&&f.commandType&&f.commandType!=b.commandType.other&&(d[c]=e(a,c))}),d};$.extend($.Arte.TextArea.prototype,{getState:function(a){var b=$.Arte.util.getSelectedTextNodes.apply(this,[!0]);return f(b,a)},getAllStates:function(a){var b=$.Arte.util.getSelectedTextNodes.apply(this,[!0]),c=[];return $.each(b,function(){var b=$(this);c.push(f(b,a))}),c}});var g=function(){return{init:function(){}}};a.register("stateDetector",g)}($.Arte.pluginManager),function(a){var b=function(a){var b=a?this.hasUndo():this.hasRedo();if(b){var c=$.Arte.constants.eventNames,d={execute:!0};this.triggerEvent(a?c.onbeforeundo:c.onbeforeredo,d),d.execute&&(this.undoInfo.index+=a?-1:1,this.outerValue(this.undoInfo.stack[this.undoInfo.index])),this.triggerEvent(a?c.onundo:c.onredo,{})}},c=function(a,b){var c=b.textArea,d=c.undoInfo,e=$.trim(c.outerValue());if(e!=d.stack[d.index]){var f=++c.undoInfo.index,g=c.undoInfo.stack;g.splice(f,g.length),g.push(e)}},d={hasUndo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index>0},hasRedo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index<this.undoInfo.stack.length-1},undo:function(){b.call(this,!0)},redo:function(){b.call(this,!1)}};$.extend($.Arte.TextArea.prototype,d),$.extend($.Arte.constants.eventNames,{onbeforeundo:"onbeforeundo",onundo:"onundo",onbeforeredo:"onbeforeredo",onredo:"onredo"});var e=function(){return{init:function(a){a.undoInfo=a.undoInfo||{stack:[],index:-1},a.$element.on({onvaluechange:c})}}};a.register("undoManager",e)}($.Arte.pluginManager),function(a){var b=function(){var a={8:"BackSpace",13:"Enter",32:"Space",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",65:"A",66:"B",67:"C",73:"I",75:"K",85:"U",86:"V",88:"X"},b=function(){},c=function(b){var c=b.ctrlKey?"CTRL+":"";c+=b.altKey?"AlT+":"";var d=a[b.keyCode];return c+=d||""},d=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"CTRL+B":d.bold(),e.preventDefault();break;case"CTRL+I":d.italic(),e.preventDefault();break;case"CTRL+U":d.underline(),e.preventDefault()}},e=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"CTRL:A":case"CTRL+V":case"CTRL+ArrowDown":case"CTRL+ArrowLeft":case"CTRL+ArrowRight":case"CTRL+ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":d.triggerEvent($.Arte.constants.eventNames.onselectionchange)}};return{init:function(a){a.$element.on({onkeydown:d,onkeypress:b,onkeyup:e})}}};a.register("keyboardEventHandler",b)}($.Arte.pluginManager),function(a){$.Arte.configuration.pasteHandler={attributes:{id:1,style:1,"class":1},style:{font:1,"font-style":1,"font-weight":1,"font-family":1,color:1,"font-size":1,"text-align":1},tag:{P:1,DIV:1,UL:1,OL:1,LI:1,SPAN:1},nodeType:{1:1,3:1},invalidTagHandlers:{B:{applierTagName:"span",styleName:"font-weight",styleValue:"bold"},I:{applierTagName:"span",styleName:"font-style",styleValue:"italic"},U:{applierTagName:"span",styleName:"text-decoration",styleValue:"underline"},FONT:{applierTagName:"span"}}};var b=$.Arte.configuration.pasteHandler,c=$.Arte.configuration.classNameSpace,d=function(a){var d=a.get(0).nodeType;if(!b.nodeType[d])return a.remove(),null;if(d==$.Arte.constants.nodeType.TEXT){var e=a.get(0).nodeValue;return e=e.replace(/<!--[\S\s]*?-->/gi,""),""===e||!e.match(/\S+/gi)||e.match(/^[\xA0]+$/gi)?(a.remove(),null):(a.get(0).nodeValue=e.replace(/\n/gi,"").replace(/[\xA0|\s+]{2,}/gi," "),null)}var f=a.html();if(!f)return a.remove(),null;var g=a.prop("tagName");if(b.tag[g]){for(var h=a.prop("attributes"),i=0;i<h.length;i++)if(!b.attributes[h[i].name])try{a.removeAttr(h[i].name)}catch(j){}var k=$.Arte.dom.getClasses(a);$.each(k,function(b,d){0!==d.indexOf(c)&&a.removeClass(d)});var l="";return $.each($.Arte.dom.getStyles(a),function(a,c){var d=b.style[a];if(d)switch(a){case"font-size":d=c.match(/\d+\s?px/);break;case"color":d=c.match(/#[a-fA-F0-9]{6}/)||c.match(/rgb\(\d+,\s*\d+\,\s*\d+\)/)}d&&(l+=a+": "+c+"; ")}),a.get(0).style.cssText=l,null}var m=b.invalidTagHandlers[a.prop("tagName")]||{tagName:"DIV"},n=$.Arte.dom.createContainer(m).html(a.html());return n},e=function(a){a.each(function(){var a=$(this);e(a.contents());var b=d(a);b&&a.replaceWith(b)})};$.extend($.Arte.constants.eventNames,{onbeforehandlepaste:"onbeforehandlepaste",onhandlepaste:"onhandlepaste"});var f=function(){return{init:function(a){a.$element.on({onpaste:function(b,c){var d={execute:!0};a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d),d.execute&&(e(c.textArea.$el.children()),a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d))}})}}};a.register("pasteHandler",f)}($.Arte.pluginManager),function(a){a.fn.ArteToolbar=function(b){b&&"object"==typeof b&&(b=a.extend({},a.Arte.Toolbar.Defaults,b));var c=a();return this.each(function(){var d=a(this).data("ArteToolbar");if(b&&"string"==typeof b){var e=b;if(this.constructor===a.Arte.Toolbar&&(d=this),!d)throw"This is not a arte toolbar.";var f=d[e].call(d);c.push(f)}else d||(a.extend(b,{element:a(this)}),d=new a.Arte.Toolbar(b),a(this).data("ArteToolbar",d)),c.push(d)}),c},a.Arte.Toolbar=function(b){var c=this;c.$el=b.element,c.$el.on({"click mousedown mouseup":function(a){a.stopPropagation(),a.preventDefault()}}),a("body").on({click:function(){c.selectionManager.clear(),c.refresh()}});var d=[];a.each(b.buttons,function(b,e){var f=a.Arte.Toolbar.configuration.buttons[e],g=new f.js(c,e,f);g.render(),d.push(g)});var e=a.Arte.Toolbar.configuration.classes;a("<div>").addClass(e.dialog.container).appendTo(c.$el),a("<div>").addClass(e.tooltip.container).appendTo(c.$el),this.refresh=function(){var b=c.selectionManager.getSelectedEditors()[0],e=b?b.getState():{};a.each(d,function(){this.refresh(e)})},this.destroy=function(){c.$el.removeData("ArteToolbar"),a.each(d,function(){this.unrender()}),a("."+e.dialog.container).remove(),a("."+e.tooltip.container).remove(),c.$el.off()},c.selectionManager=new a.Arte.Toolbar.SelectionManager,c.selectionManager.initialize({editor:b.editor}),c.selectionManager.on({selectionchanged:c.refresh}),c.refresh()}}(jQuery),function(a){a.Arte.Toolbar.Button=function(b,c,d){var e=this;e.element=null,e.commandName=d.commandName;var f=a.Arte.Toolbar.configuration,g=f.classes,h=g.button;this.isApplicable=function(){var a=b.selectionManager.getEditors(d.supportedTypes);return a&&a.length},this.isEnabled=function(){if(!f.requireEditorFocus)return!0;var a=b.selectionManager.getSelectedEditors(d.supportedTypes);return a&&a.length},this.executeCommand=function(c){if(this.isEnabled()){var e=d&&d.commandAttrType?d.commandAttrType:a.Arte.Toolbar.configuration.commandAttrType,g=c||(d.commandValue?d.commandValue[e]:"");g||d.supportsTagName||!d.commandValue||(e=a.Arte.Toolbar.configuration.altCommandAttrType,g=d.commandValue[e]);var h={commandName:d.commandName,commandValue:g,commandAttrType:e},i=b.selectionManager.getSelectedEditors();i.length||f.requireEditorFocus||(i=b.selectionManager.getEditors()),a.each(i,function(){this[h.commandName].call(this,h)}),b.refresh()}},this.render=function(){var d=a("<span>").addClass(c).addClass(h.inner);e.$el=a("<a>").attr("href","#").addClass(h.outer).html(d),e.$el.on({mouseover:function(a){e.showTooltip(a)},mouseout:function(a){e.hideTooltip(a)},mousedown:function(a){a.preventDefault(),a.stopPropagation()},click:function(a){e.executeCommand.apply(e),a.preventDefault(),a.stopPropagation()
}}),e.$el.appendTo(b.$el)},this.unrender=function(){e.$el.off(),e.$el.remove()};var i=function(b){if("textAlign"===d.commandName){var c=d.commandValue[a.Arte.Toolbar.configuration.commandAttrType]||d.commandValue[a.Arte.Toolbar.configuration.altCommandAttrType];return b===c}return b};this.refresh=function(a){if(!this.isApplicable())return void this.$el.hide();if(this.$el.show(),this.isEnabled()){e.$el.removeClass(h.disabled);var b=i(a[d.commandName])?"addClass":"removeClass";e.$el[b](h.selected)}else e.$el.addClass(h.disabled),e.$el.removeClass(h.selected)},this.showTooltip=function(a){if(!e.$el.hasClass(h.disabled)){var c=b.$el.find("."+g.tooltip.container);c.html(d.tooltip||this.commandName);var f=b.$el.offset(),i=a.pageX-f.left+15,j=a.pageY-f.top+5;c.css({top:j,left:i}),c.show()}},this.hideTooltip=function(){e.$el.hasClass(h.disabled)||b.$el.find("."+g.tooltip.container).hide()}}}(jQuery),function(a){a.Arte.Toolbar.ButtonWithDialog=function(b,c,d){var e=this;a.Arte.Toolbar.Button.call(this,b,c,d);var f=a.Arte.Toolbar.configuration.classes.dialog;return this.executeCommand=function(){e.isEnabled()&&e.showPopup()},this.getOkCancelControl=function(){var b=a("<div>").addClass(f.okCancel);return a("<a>").attr("href","#").addClass(f.button+" ok").html("&#x2713").appendTo(b),a("<a>").attr("href","#").addClass(f.button+" cancel").html("&#x2717").appendTo(b),b},this.showPopup=function(){var b=a("."+f.container),c=a("<div>").addClass(f.contentWrapper).appendTo(b);c.append(e.getDialogContent()),c.append(e.getOkCancelControl()),b.on("mousedown ",function(a){a.stopPropagation()});var d=rangy.saveSelection();e.addContent(),c.find(".ok").on("click",function(){rangy.restoreSelection(d),e.onOk(),e.closePopup()}),c.find(".cancel").on("click",function(){rangy.restoreSelection(d),e.closePopup()}),b.show({duration:200,complete:function(){c.css("margin-top",-1*c.height()/2)}})},this.closePopup=function(){var b=a("."+f.container);b.children().each(function(){this.remove()}),b.hide()},e}}(jQuery),function(){$.Arte.Toolbar.InsertLink=function(a,b,c){var d=$.Arte.Toolbar.configuration.classes.dialog,e=d.insertLink;$.Arte.Toolbar.ButtonWithDialog.call(this,a,b,c);var f=function(b){$.each(a.selectionManager.getSelectedEditors(),function(){this.insert.call(this,{commandValue:b})})};this.getDialogContent=function(){var a=$("<div>").addClass(d.insertLink.textToShow);$("<span>").html("Text to Show: ").addClass(d.label).appendTo(a),$("<input>").addClass(e.input+" textToShow").attr({type:"text"}).appendTo(a);var b=$("<div>").addClass(d.insertLink.urlInput);$("<span>").html("Url: ").addClass(d.label).appendTo(b),$("<input>").addClass(e.input+" url").attr({type:"text"}).appendTo(b);var c=$("<div>").addClass(d.content).append(a).append(b);return c},this.onOk=function(){var a=$("."+d.container+" ."+d.insertLink.textToShow+" input").val(),b=$("."+d.container+" ."+d.insertLink.urlInput+" input").val();if(b){var c=$("<a>").attr("href",b).html(a||b);f(c.get(0).outerHTML)}},this.addContent=function(){$("."+d.container+" .textToShow").val(rangy.getSelection().toHtml())}}}(jQuery),function(){$.Arte.Toolbar.InsertImage=function(a,b,c){var d=$.Arte.Toolbar.configuration.classes.dialog,e=d.insertLink;$.Arte.Toolbar.ButtonWithDialog.call(this,a,b,c);var f=function(b){$.each(a.selectionManager.getSelectedEditors(),function(){this.insert.call(this,{commandValue:b})})};this.getDialogContent=function(){var a=$("<div>").addClass("input-prepend input-append");return $("<span>").html("Text to Show: ").addClass(e.label).appendTo(a),$("<input>").addClass(e.input+" textToShow").attr({type:"text"}).appendTo(a).css({height:"auto"}),$("<span>").html("Url: ").addClass(e.label).appendTo(a),$("<input>").addClass(e.input+" url").attr({type:"text"}).appendTo(a).css({height:"auto"}),a},this.onOk=function(){var a=$("."+d.container+" .url").val();if(a){var b=$("<img>").attr("src",a);f(b.get(0).outerHTML)}},this.addContent=function(){$("."+d.container+" .textToShow").val(rangy.getSelection().toHtml())}}}(jQuery),function(a){a.Arte.Toolbar.ButtonWithDropDown=function(b,c,d){var e=a.Arte.Toolbar.configuration.classes;a.Arte.Toolbar.Button.call(this,b,c,d);var f=this;this.render=function(){var g=a("<select>").addClass(e.select).addClass(this.name);a.each(d.options,function(b,d){var e,f;switch(a.isPlainObject(d)?(e=d.display,f=d.value):(e=d,f="string"==typeof d?d.toLowerCase():d),c){case"color":f=a("<div>").css("color",f).css("color");break;case"fontSize":!f||isNaN(+f)||/px$/.test(f)||(f+="px");break;case"fontFamily":!f.match(/^\".+\"$/)&&f.match(/^(?:\d.+|.+\s.+)$/)&&(f="'"+f+"'")}g.append(a("<option>").attr("value",f).html(e))}),g.appendTo(b.$el),g.on({change:function(){f.executeCommand.apply(f,[this.value])},click:function(a){a.preventDefault(),a.stopPropagation()},mousedown:function(a){a.stopPropagation()},mouseover:function(a){f.showTooltip(a)},mouseout:function(a){f.hideTooltip(a)}}),this.$el=g},this.unrender=function(){f.$el.off(),f.$el.remove()},this.refresh=function(a){if(!this.isApplicable())return void this.$el.hide();this.$el.show();var b=this.isEnabled()?"removeAttr":"attr";this.$el[b]("disabled",!0);var c=a[d.commandName];this.$el.val(c)}}}(jQuery),function(a){a.Arte.Toolbar=a.Arte.Toolbar||{};var b=a.Arte.Toolbar.Button,c=a.Arte.Toolbar.ButtonWithDropDown,d=a.Arte.constants.commandAttrType,e=a.Arte.constants.editorTypes;a.Arte.Toolbar.configuration={requireEditorFocus:!0,commandAttrType:d.styleName,altCommandAttrType:d.styleName,buttons:{bold:{js:b,commandName:"bold",commandValue:{styleName:"bold",className:"arte-font-weight-bold"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Bold"},italic:{js:b,commandName:"italic",commandValue:{styleName:"italic",className:"arte-font-style-italic"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Italic"},underline:{js:b,commandName:"underline",commandValue:{styleName:"underline",className:"arte-text-decoration-underline"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Underline"},blockquote:{js:b,commandName:"blockquote",supportedTypes:[e.richText],tooltip:"Blockquote"},textAlignLeft:{js:b,icon:"../content/Icons/icons/text_align_left.png",commandName:"textAlign",commandValue:{styleName:"left",className:"arte-text-align-left"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align left"},textAlignCenter:{js:b,icon:"../content/Icons/icons/text_align_center.png",commandName:"textAlign",commandValue:{styleName:"center",className:"arte-text-align-center"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align center"},textAlignRight:{js:b,icon:"../content/Icons/icons/text_align_right.png",commandName:"textAlign",commandValue:{styleName:"right",className:"arte-text-align-right"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align right"},h1:{js:b,commandName:"h1",icon:"../content/Icons/icons/text_heading_1.png",supportedTypes:[e.richText],tooltip:"H1"},h2:{js:b,commandName:"h2",icon:"../content/Icons/icons/text_heading_2.png",supportedTypes:[e.richText],tooltip:"H2"},h3:{js:b,commandName:"h3",icon:"../content/Icons/icons/text_heading_3.png",supportedTypes:[e.richText],tooltip:"H3"},h4:{js:b,commandName:"h4",icon:"../content/Icons/icons/text_heading_4.png",supportedTypes:[e.richText],tooltip:"H4"},h5:{js:b,commandName:"h5",icon:"../content/Icons/icons/text_heading_5.png",supportedTypes:[e.richText],tooltip:"H5"},h6:{js:b,commandName:"h6",icon:"../content/Icons/icons/text_heading_6.png",supportedTypes:[e.richText],tooltip:"H6"},subscript:{js:b,commandName:"subscript",icon:"../content/Icons/icons/text_subscript.png",supportedTypes:[e.richText],tooltip:"Subscript"},superscript:{js:b,commandName:"superscript",icon:"../content/Icons/icons/text_superscript.png",supportedTypes:[e.richText],tooltip:"Superscript"},fontSize:{js:c,icon:null,commandName:"fontSize",options:["",8,10,12,15,20],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Font size"},fontFamily:{js:c,icon:null,commandName:"fontFamily",options:["","Arial","curier new","Georgia","Times New Roman"],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Font family"},color:{js:c,icon:null,commandName:"color",options:["","Black","Blue","Green","Red"],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Color"},unorderedList:{js:b,commandName:"unorderedList",supportedTypes:[e.richText],tooltip:"Unordered list"},orderedList:{js:b,commandName:"orderedList",supportedTypes:[e.richText],tooltip:"Ordered list"},backgroundColor:{acceptsParams:!0,js:c,commandName:"backgroundColor",options:["","Black","Blue","Green","Red"],supportedTypes:[e.richText],tooltip:"Background Color"},undo:{js:b,commandName:"undo",supportedTypes:[e.richText,e.plainText],tooltip:"Undo"},redo:{js:b,commandName:"redo",supportedTypes:[e.richText,e.plainText],tooltip:"Redo"},toolbarLineBreak:{js:function(){return{render:function(b){a("<div>").appendTo(b)},refresh:function(){}}}},insertLink:{commandName:"insert",js:a.Arte.Toolbar.InsertLink,supportedTypes:[e.richText],tooltip:"Insert link"},insertImage:{commandName:"insert",js:a.Arte.Toolbar.InsertImage,supportedTypes:[e.richText],tooltip:"Insert Image"}},classes:{button:{outer:"btn",inner:"btn-inner",disabled:"disabled",selected:"selected"},select:{inner:"select"},dialog:{container:"inline-dialog",contentWrapper:"content-wrapper",content:"dialog-content",okCancel:"ok-cancel",label:"label",button:"btn",insertLink:{button:"btn",textToShow:"text-to-show",urlInput:"url-input"},insertImage:{}},tooltip:{container:"tooltip"}}}}(jQuery),function(a){a.Arte.Toolbar=a.Arte.Toolbar||{},a.Arte.Toolbar.SelectionManager=function(){var b=a(),c=[];this.getSelectedEditors=function(b){return b?a.Arte.util.filterCollection(c,function(c,d){return a.Arte.util.any(b,function(a,b){return d.editorType===b})}):c},this.getEditors=function(c){return c?a.Arte.util.filterCollection(b,function(b,d){return a.Arte.util.any(c,function(a,b){return d.editorType===b})}):b},this.initialize=function(d){var e=this,f=a(d&&d.editor?d.editor:"["+a.Arte.configuration.textFieldIdentifier+"]");b=a.map(f,function(b){return a(b).Arte().get(0)}),a.each(b,function(){this.on({onfocus:function(b,d){e.clear(),c.push(d.textArea),a(e).trigger("selectionchanged",b)},onselectionchange:function(b){a(e).trigger("selectionchanged",b)}})})},this.clear=function(){c.splice(0,c.length)},this.on=function(b,c){a(this).on(b,c)},this.off=function(b,c){a(this).off(b,c)}}}(jQuery);