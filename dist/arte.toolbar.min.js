!function(a){a.fn.ArteToolbar=function(b){b&&"object"==typeof b&&(b=a.extend({},a.Arte.Toolbar.Defaults,b));var c=a();return this.each(function(){var d=a(this).data("ArteToolbar");if(b&&"string"==typeof b){var e=b;if(this.constructor===a.Arte.Toolbar&&(d=this),!d)throw"This is not a arte toolbar.";var f=d[e].call(d);c.push(f)}else d||(a.extend(b,{element:a(this)}),d=new a.Arte.Toolbar(b),a(this).data("ArteToolbar",d)),c.push(d)}),c},a.Arte.Toolbar=function(b){var c=this;c.$el=b.element,c.$el.on({"click mousedown mouseup":function(a){a.stopPropagation(),a.preventDefault()}}),a("body").on({click:function(){c.selectionManager.clear(),c.refresh()}});var d=[];a.each(b.buttons,function(b,e){var f=a.Arte.Toolbar.configuration.buttons[e],g=new f.js(c,e,f);g.render(),d.push(g)});var e=a.Arte.Toolbar.configuration.classes;a("<div>").addClass(e.dialog.container).appendTo(c.$el),a("<div>").addClass(e.tooltip.container).appendTo(c.$el),this.refresh=function(){var b=c.selectionManager.getSelectedEditors()[0],e=b?b.getState():{};a.each(d,function(){this.refresh(e)})},this.destroy=function(){c.$el.removeData("ArteToolbar"),a.each(d,function(){this.unrender()}),a("."+e.dialog.container).remove(),a("."+e.tooltip.container).remove(),c.$el.off()},c.selectionManager=new a.Arte.Toolbar.SelectionManager,c.selectionManager.initialize({editor:b.editor}),c.selectionManager.on({selectionchanged:c.refresh}),c.refresh()}}(jQuery),function(a){a.Arte.Toolbar.Button=function(b,c,d){var e=this;e.element=null,e.commandName=d.commandName;var f=a.Arte.Toolbar.configuration,g=f.classes,h=g.button;this.isApplicable=function(){var a=b.selectionManager.getEditors(d.supportedTypes);return a&&a.length},this.isEnabled=function(){if(!f.requireEditorFocus)return!0;var a=b.selectionManager.getSelectedEditors(d.supportedTypes);return a&&a.length},this.executeCommand=function(c){if(this.isEnabled()){var e=d&&d.commandAttrType?d.commandAttrType:a.Arte.Toolbar.configuration.commandAttrType,g=c||(d.commandValue?d.commandValue[e]:"");g||d.supportsTagName||!d.commandValue||(e=a.Arte.Toolbar.configuration.altCommandAttrType,g=d.commandValue[e]);var h={commandName:d.commandName,commandValue:g,commandAttrType:e},i=b.selectionManager.getSelectedEditors();i.length||f.requireEditorFocus||(i=b.selectionManager.getEditors()),a.each(i,function(){this[h.commandName].call(this,h)}),b.refresh()}},this.render=function(){var d=a("<span>").addClass(c).addClass(h.inner);e.$el=a("<a>").attr("href","#").addClass(h.outer).html(d),e.$el.on({mouseover:function(a){e.showTooltip(a)},mouseout:function(a){e.hideTooltip(a)},mousedown:function(a){a.preventDefault(),a.stopPropagation()},click:function(a){e.executeCommand.apply(e),a.preventDefault(),a.stopPropagation()}}),e.$el.appendTo(b.$el)},this.unrender=function(){e.$el.off(),e.$el.remove()};var i=function(b){if("textAlign"===d.commandName){var c=d.commandValue[a.Arte.Toolbar.configuration.commandAttrType]||d.commandValue[a.Arte.Toolbar.configuration.altCommandAttrType];return b===c}return b};this.refresh=function(a){if(!this.isApplicable())return void this.$el.hide();if(this.$el.show(),this.isEnabled()){e.$el.removeClass(h.disabled);var b=i(a[d.commandName])?"addClass":"removeClass";e.$el[b](h.selected)}else e.$el.addClass(h.disabled),e.$el.removeClass(h.selected)},this.showTooltip=function(a){if(!e.$el.hasClass(h.disabled)){var c=b.$el.find("."+g.tooltip.container);c.html(d.tooltip||this.commandName);var f=b.$el.offset(),i=a.pageX-f.left+15,j=a.pageY-f.top+5;c.css({top:j,left:i}),c.show()}},this.hideTooltip=function(){e.$el.hasClass(h.disabled)||b.$el.find("."+g.tooltip.container).hide()}}}(jQuery),function(a){a.Arte.Toolbar.ButtonWithDialog=function(b,c,d){var e=this;a.Arte.Toolbar.Button.call(this,b,c,d);var f=a.Arte.Toolbar.configuration.classes.dialog;return this.executeCommand=function(){e.isEnabled()&&e.showPopup()},this.getOkCancelControl=function(){var b=a("<div>").addClass(f.okCancel);return a("<a>").attr("href","#").addClass(f.button+" ok").html("&#x2713").appendTo(b),a("<a>").attr("href","#").addClass(f.button+" cancel").html("&#x2717").appendTo(b),b},this.showPopup=function(){var b=a("."+f.container),c=a("<div>").addClass(f.contentWrapper).appendTo(b);c.append(e.getDialogContent()),c.append(e.getOkCancelControl()),b.on("mousedown ",function(a){a.stopPropagation()});var d=rangy.saveSelection();e.addContent(),c.find(".ok").on("click",function(){rangy.restoreSelection(d),e.onOk(),e.closePopup()}),c.find(".cancel").on("click",function(){rangy.restoreSelection(d),e.closePopup()}),b.show({duration:200,complete:function(){c.css("margin-top",-1*c.height()/2)}})},this.closePopup=function(){var b=a("."+f.container);b.children().each(function(){this.remove()}),b.hide()},e}}(jQuery),function(){$.Arte.Toolbar.InsertLink=function(a,b,c){var d=$.Arte.Toolbar.configuration.classes.dialog,e=d.insertLink;$.Arte.Toolbar.ButtonWithDialog.call(this,a,b,c);var f=function(b){$.each(a.selectionManager.getSelectedEditors(),function(){this.insert.call(this,{commandValue:b})})};this.getDialogContent=function(){var a=$("<div>").addClass(d.insertLink.textToShow);$("<span>").html("Text to Show: ").addClass(d.label).appendTo(a),$("<input>").addClass(e.input+" textToShow").attr({type:"text"}).appendTo(a);var b=$("<div>").addClass(d.insertLink.urlInput);$("<span>").html("Url: ").addClass(d.label).appendTo(b),$("<input>").addClass(e.input+" url").attr({type:"text"}).appendTo(b);var c=$("<div>").addClass(d.content).append(a).append(b);return c},this.onOk=function(){var a=$("."+d.container+" ."+d.insertLink.textToShow+" input").val(),b=$("."+d.container+" ."+d.insertLink.urlInput+" input").val();if(b){var c=$("<a>").attr("href",b).html(a||b);f(c.get(0).outerHTML)}},this.addContent=function(){$("."+d.container+" .textToShow").val(rangy.getSelection().toHtml())}}}(jQuery),function(){$.Arte.Toolbar.InsertImage=function(a,b,c){var d=$.Arte.Toolbar.configuration.classes.dialog,e=d.insertLink;$.Arte.Toolbar.ButtonWithDialog.call(this,a,b,c);var f=function(b){$.each(a.selectionManager.getSelectedEditors(),function(){this.insert.call(this,{commandValue:b})})};this.getDialogContent=function(){var a=$("<div>").addClass("input-prepend input-append");return $("<span>").html("Text to Show: ").addClass(e.label).appendTo(a),$("<input>").addClass(e.input+" textToShow").attr({type:"text"}).appendTo(a).css({height:"auto"}),$("<span>").html("Url: ").addClass(e.label).appendTo(a),$("<input>").addClass(e.input+" url").attr({type:"text"}).appendTo(a).css({height:"auto"}),a},this.onOk=function(){var a=$("."+d.container+" .url").val();if(a){var b=$("<img>").attr("src",a);f(b.get(0).outerHTML)}},this.addContent=function(){$("."+d.container+" .textToShow").val(rangy.getSelection().toHtml())}}}(jQuery),function(a){a.Arte.Toolbar.ButtonWithDropDown=function(b,c,d){var e=a.Arte.Toolbar.configuration.classes;a.Arte.Toolbar.Button.call(this,b,c,d);var f=this;this.render=function(){var g=a("<select>").addClass(e.select).addClass(this.name);a.each(d.options,function(b,d){var e,f;switch(a.isPlainObject(d)?(e=d.display,f=d.value):(e=d,f="string"==typeof d?d.toLowerCase():d),c){case"color":f=a("<div>").css("color",f).css("color");break;case"fontSize":!f||isNaN(+f)||/px$/.test(f)||(f+="px");break;case"fontFamily":!f.match(/^\".+\"$/)&&f.match(/^(?:\d.+|.+\s.+)$/)&&(f="'"+f+"'")}g.append(a("<option>").attr("value",f).html(e))}),g.appendTo(b.$el),g.on({change:function(){f.executeCommand.apply(f,[this.value])},click:function(a){a.preventDefault(),a.stopPropagation()},mousedown:function(a){a.stopPropagation()},mouseover:function(a){f.showTooltip(a)},mouseout:function(a){f.hideTooltip(a)}}),this.$el=g},this.unrender=function(){f.$el.off(),f.$el.remove()},this.refresh=function(a){if(!this.isApplicable())return void this.$el.hide();this.$el.show();var b=this.isEnabled()?"removeAttr":"attr";this.$el[b]("disabled",!0);var c=a[d.commandName];this.$el.val(c)}}}(jQuery),function(a){a.Arte.Toolbar=a.Arte.Toolbar||{};var b=a.Arte.Toolbar.Button,c=a.Arte.Toolbar.ButtonWithDropDown,d=a.Arte.constants.commandAttrType,e=a.Arte.constants.editorTypes;a.Arte.Toolbar.configuration={requireEditorFocus:!0,commandAttrType:d.styleName,altCommandAttrType:d.styleName,buttons:{bold:{js:b,commandName:"bold",commandValue:{styleName:"bold",className:"arte-font-weight-bold"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Bold"},italic:{js:b,commandName:"italic",commandValue:{styleName:"italic",className:"arte-font-style-italic"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Italic"},underline:{js:b,commandName:"underline",commandValue:{styleName:"underline",className:"arte-text-decoration-underline"},supportedTypes:[e.richText,e.plainText],supportsTagName:!0,tooltip:"Underline"},blockquote:{js:b,commandName:"blockquote",supportedTypes:[e.richText],tooltip:"Blockquote"},textAlignLeft:{js:b,icon:"../content/Icons/icons/text_align_left.png",commandName:"textAlign",commandValue:{styleName:"left",className:"arte-text-align-left"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align left"},textAlignCenter:{js:b,icon:"../content/Icons/icons/text_align_center.png",commandName:"textAlign",commandValue:{styleName:"center",className:"arte-text-align-center"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align center"},textAlignRight:{js:b,icon:"../content/Icons/icons/text_align_right.png",commandName:"textAlign",commandValue:{styleName:"right",className:"arte-text-align-right"},supportedTypes:[e.richText,e.plainText],tooltip:"Text align right"},h1:{js:b,commandName:"h1",icon:"../content/Icons/icons/text_heading_1.png",supportedTypes:[e.richText],tooltip:"H1"},h2:{js:b,commandName:"h2",icon:"../content/Icons/icons/text_heading_2.png",supportedTypes:[e.richText],tooltip:"H2"},h3:{js:b,commandName:"h3",icon:"../content/Icons/icons/text_heading_3.png",supportedTypes:[e.richText],tooltip:"H3"},h4:{js:b,commandName:"h4",icon:"../content/Icons/icons/text_heading_4.png",supportedTypes:[e.richText],tooltip:"H4"},h5:{js:b,commandName:"h5",icon:"../content/Icons/icons/text_heading_5.png",supportedTypes:[e.richText],tooltip:"H5"},h6:{js:b,commandName:"h6",icon:"../content/Icons/icons/text_heading_6.png",supportedTypes:[e.richText],tooltip:"H6"},subscript:{js:b,commandName:"subscript",icon:"../content/Icons/icons/text_subscript.png",supportedTypes:[e.richText],tooltip:"Subscript"},superscript:{js:b,commandName:"superscript",icon:"../content/Icons/icons/text_superscript.png",supportedTypes:[e.richText],tooltip:"Superscript"},fontSize:{js:c,icon:null,commandName:"fontSize",options:["",8,10,12,15,20],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Font size"},fontFamily:{js:c,icon:null,commandName:"fontFamily",options:["","Arial","curier new","Georgia","Times New Roman"],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Font family"},color:{js:c,icon:null,commandName:"color",options:["","Black","Blue","Green","Red"],acceptsParams:!0,supportedTypes:[e.richText,e.plainText],tooltip:"Color"},unorderedList:{js:b,commandName:"unorderedList",supportedTypes:[e.richText],tooltip:"Unordered list"},orderedList:{js:b,commandName:"orderedList",supportedTypes:[e.richText],tooltip:"Ordered list"},backgroundColor:{acceptsParams:!0,js:c,commandName:"backgroundColor",options:["","Black","Blue","Green","Red"],supportedTypes:[e.richText],tooltip:"Background Color"},undo:{js:b,commandName:"undo",supportedTypes:[e.richText,e.plainText],tooltip:"Undo"},redo:{js:b,commandName:"redo",supportedTypes:[e.richText,e.plainText],tooltip:"Redo"},toolbarLineBreak:{js:function(){return{render:function(b){a("<div>").appendTo(b)},refresh:function(){}}}},insertLink:{commandName:"insert",js:a.Arte.Toolbar.InsertLink,supportedTypes:[e.richText],tooltip:"Insert link"},insertImage:{commandName:"insert",js:a.Arte.Toolbar.InsertImage,supportedTypes:[e.richText],tooltip:"Insert Image"}},classes:{button:{outer:"btn",inner:"btn-inner",disabled:"disabled",selected:"selected"},select:{inner:"select"},dialog:{container:"inline-dialog",contentWrapper:"content-wrapper",content:"dialog-content",okCancel:"ok-cancel",label:"label",button:"btn",insertLink:{button:"btn",textToShow:"text-to-show",urlInput:"url-input"},insertImage:{}},tooltip:{container:"tooltip"}}}}(jQuery),function(a){a.Arte.Toolbar=a.Arte.Toolbar||{},a.Arte.Toolbar.SelectionManager=function(){var b=a(),c=[];this.getSelectedEditors=function(b){return b?a.Arte.util.filterCollection(c,function(c,d){return a.Arte.util.any(b,function(a,b){return d.editorType===b})}):c},this.getEditors=function(c){return c?a.Arte.util.filterCollection(b,function(b,d){return a.Arte.util.any(c,function(a,b){return d.editorType===b})}):b},this.initialize=function(d){var e=this,f=a(d&&d.editor?d.editor:"["+a.Arte.configuration.textFieldIdentifier+"]");b=a.map(f,function(b){return a(b).Arte().get(0)}),a.each(b,function(){this.on({onfocus:function(b,d){e.clear(),c.push(d.textArea),a(e).trigger("selectionchanged",b)},onselectionchange:function(b){a(e).trigger("selectionchanged",b)}})})},this.clear=function(){c.splice(0,c.length)},this.on=function(b,c){a(this).on(b,c)},this.off=function(b,c){a(this).off(b,c)}}}(jQuery);