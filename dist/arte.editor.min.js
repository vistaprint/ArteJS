!function(a){a.Arte=a.Arte||{},a.fn.Arte=function(b,c){var d=[];return rangy.init(),this.each(function(){var e=a(this),f=e.data("Arte");if(b&&"string"==typeof b){var g=b;if(this.constructor===a.Arte.TextArea&&(f=this),!f)throw"This is not a rich text field.";var h=f[g].call(f,c);d.push(h)}else f||(b=b||{},b.element=this,f=new a.Arte.TextArea(b),e.data("Arte",f)),d.push(f)}),a(d)}}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.TextArea=function(b){var c=this,d=a.Arte.configuration,e=a.Arte.constants;c.$element=a(b.element),c.element=c.$element.get(0),c._container=c.element;var f=a.extend({},d.initialValues,b),g=e.eventNames;this.editorType=b.editorType||e.editorTypes.richText,this._currentOuterValue="";var h=null,i=function(){var b=c._container.innerHTML,d=c._currentOuterValue;if(b!==d){var e=c.$el.contents();if(a.Arte.dom.hasUnsanctionedElements(e)){var f;k&&(f=rangy.saveSelection()),a.Arte.dom.handleUnsanctionedElements(e),k&&rangy.restoreSelection(f)}c._currentOuterValue=c._container.innerHTML,c.triggerEvent(g.onvaluechange,{newValue:c.value(),src:"internal"})}},j=function(){h||(h=setInterval(i,d.pollIntervalInMs))};if(c.element.hasChildNodes()){if(c.el=c._container.childNodes[0],"DIV"===c.el.tagName)c.el.setAttribute("contenteditable","true");else if("TEXTAREA"!==c.el.tagName)throw new Error("Cannot make element editable");c.$el=a(c.el)}else c.editorType===e.editorTypes.richText?(c.el=document.createElement("div"),c.el.setAttribute("contenteditable","true")):(c.el=document.createElement("textarea"),c.el.style.height="100%",c.el.style.width="100%",c.el.style.padding=0,c.el.style.border=0),c._container.appendChild(c.el),c.$el=a(c.el);c.$el.css(f.styles),c.el.setAttribute("class",f.classes.join(" ")),c._container.setAttribute(d.textFieldIdentifier,"1");var k=!1;c.$el.on({keydown:function(a){c.triggerEvent(g.onkeydown,{originalEvent:a}),a.stopPropagation()},keyup:function(a){c.triggerEvent(g.onkeyup,{originalEvent:a}),a.stopPropagation()},keypress:function(a){c.triggerEvent(g.onkeypress,{originalEvent:a}),a.stopPropagation()},focus:function(a){k||(k=!0,c.triggerEvent(g.onfocus,{originalEvent:a})),j(),a.stopPropagation()},blur:function(a){i(),k=!1,c.triggerEvent(g.onselectionchange),c.triggerEvent(g.onblur,{originalEvent:a}),h&&(clearInterval(h),h=null),a.stopPropagation()},mouseup:function(a){c.triggerEvent(g.onselectionchange),c.triggerEvent(g.onmouseup,{originalEvent:a})},mousedown:function(a){c.triggerEvent(g.onmousedown,{originalEvent:a})},click:function(a){c.triggerEvent(g.onclick,{originalEvent:a})},paste:function(a){setTimeout(function(){c.triggerEvent(g.onpaste,{originalEvent:a})},50)}}),a.Arte.pluginManager.init(c),c.value(f.value),a(c._container).on(b.on),c.triggerEvent(g.oncreate)},a.extend(a.Arte.TextArea.prototype,{value:function(b){var c=a.Arte.constants,d=this.editorType===c.editorTypes.richText?"innerHTML":"value",e=this.el[d];return"undefined"==typeof b?e:void(e!==b&&(this.el[d]=b,this._currentOuterValue=this._container.innerHTML,this.triggerEvent(c.eventNames.onvaluechange,{newValue:b,src:"external"})))},outerValue:function(b){if("undefined"==typeof b){var c=this.$element.clone();return c.children().removeAttr("contenteditable"),c.html()}var d=a(b)[0];this.el.setAttribute("style",d.getAttribute("style")||""),this.el.setAttribute("class",d.getAttribute("class")||""),this.value(d.innerHTML)},focus:function(){var b=this,c=function(){b.$el.off("focus",c),a.Arte.util.moveCursorToEndOfElement(b.$el.get(0)),b.triggerEvent(a.Arte.constants.eventNames.onselectionchange)};b.$el.on("focus",c),b.$el.focus()},triggerEvent:function(b,c){this.$element.trigger(b,a.extend(c,{textArea:this}))},destroy:function(b){this.$element.removeData("Arte"),this.$element.removeAttr(a.Arte.configuration.textFieldIdentifier),this.$element.off(),this.$el.off(),this.$el.removeAttr("contentEditable"),this.triggerEvent(a.Arte.constants.eventNames.ondestroy),b&&b.removeContent&&this.$element.empty()},on:function(a,b){this.$element.on(a,b)},off:function(a,b){this.$element.off(a,b)}})}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.constants={editorTypes:{richText:"richText",plainText:"plainText"},commandType:{inline:"inline",block:"block",complex:"complex",other:"other"},nodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,COMMENT:8},tagName:{LI:"LI",OL:"OL",UL:"UL",BR:"BR",DIV:"DIV",SPAN:"SPAN",P:"P",B:"B",I:"I",U:"U",STRONG:"STRONG",SUB:"SUB",SUP:"SUP",BLOCKQUOTE:"BLOCKQUOTE",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6"},eventNames:{oninput:"oninput",onfocus:"onfocus",onblur:"onblur",onvaluechange:"onvaluechange",onmousedown:"onmousedown",onmouseup:"onmouseup",onclick:"onclick",onkeydown:"onkeydown",onkeypress:"onkeypress",onkeyup:"onkeyup",onpaste:"onpaste",onselectionchange:"onselectionchange",onbeforecommand:"onbeforecommand",oncommand:"oncommand",oncreate:"oncreate",ondestroy:"ondestroy"},commandAttrType:{tagName:"tagName",styleName:"styleName",className:"className",other:"other"}};var b=a.Arte.constants;a.Arte.configuration={requireFocus:!0,classNameSpace:"arte",commandAttrType:b.commandAttrType.styleName,textFieldIdentifier:"rteTextField",rangySelectionBoundaryClassName:"rangySelectionBoundary",defaultInlineTag:b.tagName.SPAN,defaultBlockTag:b.tagName.P,pollIntervalInMs:350,handleUnsanctionedTagsOnGetValue:!0},a.Arte.configuration.initialValues={styles:{"min-height":"200px",height:"inherit"},classes:[],value:"Please enter text ..."};var c=a.Arte.configuration;a.Arte.configuration.commands={bold:{commandType:b.commandType.inline,tagName:b.tagName.B,styleName:"font-weight",classNameRegex:new RegExp(c.classNameSpace+"-font-weight-[\\S]+"),defaultValue:{styleName:"bold",className:c.classNameSpace+"-font-weight-bold"},applierTagName:{tagName:b.tagName.B,className:b.tagName.SPAN,styleName:b.tagName.SPAN},supportsPlainText:!0},italic:{tagName:b.tagName.I,applierTagName:{tagName:b.tagName.I,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"font-style",classNameRegex:new RegExp(c.classNameSpace+"-font-style-italic"),commandType:b.commandType.inline,defaultValue:{styleName:"italic",className:c.classNameSpace+"-font-style-italic"},supportsPlainText:!0},underline:{tagName:b.tagName.U,applierTagName:{tagName:b.tagName.U,className:b.tagName.SPAN,styleName:b.tagName.SPAN},styleName:"text-decoration",classNameRegex:new RegExp(c.classNameSpace+"-text-decoration-[\\S]+"),commandType:b.commandType.inline,defaultValue:{styleName:"underline",className:c.classNameSpace+"-text-decoration-underline"},supportsPlainText:!0},blockquote:{tagName:b.tagName.BLOCKQUOTE,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h1:{tagName:b.tagName.H1,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h2:{tagName:b.tagName.H2,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h3:{tagName:b.tagName.H3,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h4:{tagName:b.tagName.H4,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h5:{tagName:b.tagName.H5,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},h6:{tagName:b.tagName.H6,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},orderedList:{tagName:b.tagName.OL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},unorderedList:{tagName:b.tagName.UL,commandType:b.commandType.complex,commandAttrType:b.commandAttrType.tagName},subscript:{tagName:b.tagName.SUB,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},superscript:{tagName:b.tagName.SUP,commandType:b.commandType.inline,commandAttrType:b.commandAttrType.tagName},_li:{tagName:b.tagName.LI,commandType:b.commandType.block,commandAttrType:b.commandAttrType.tagName},insert:{tagName:b.tagName.SPAN,commandType:b.commandType.other,commandAttrType:b.commandAttrType.other},fontSize:{styleName:"font-size",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-size-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},fontFamily:{styleName:"font-family",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-family-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},color:{styleName:"color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-font-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},backgroundColor:{styleName:"background-color",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-background-color-[\\S]+"),applierTagName:b.tagName.SPAN,commandType:b.commandType.inline,supportsPlainText:!0},textAlign:{styleName:"text-align",acceptsParams:!0,classNameRegex:new RegExp(c.classNameSpace+"-text-align-[\\S]+"),applierTagName:b.tagName.P,commandType:b.commandType.block,supportsPlainText:!0}},function(){a.each(c.commands,function(a,b){b.commandName=a})}()}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.pluginManager={plugins:{},register:function(a,b){this.plugins[a]=b},init:function(a){a.pluginInstances=a.pluginInstances||[];for(var b in this.plugins){var c=new this.plugins[b];c.init(a),a.pluginInstances.push(c)}}}}(jQuery),function(){var a=$.Arte.constants,b=$.Arte.configuration,c=a.commandAttrType,d=function(a,d){var e=b.commands[a];if(e.commandAttrType)return e.commandAttrType;var f=b.commandAttrType;return d?(d.commandAttrType?f=d.commandAttrType:d.styleName?f=c.styleName:d.className?f=c.className:d.tagName&&(f=c.tagName),f):f},e=function(b,c){var d=h.call(this,b,c);d.execute=!0,this.triggerEvent(a.eventNames.onbeforecommand,d),d.execute&&(delete d.execute,$.Arte.RichTextCommandApplier.createAndExecute(d),this.triggerEvent(a.eventNames.oncommand,d))},f=function(a,d,e){if(e&&d===c.styleName&&e.styleValue)return e.styleValue;if(e&&d===c.className&&e.className)return e.className;if(e&&e.commandValue)return e.commandValue;if("string"==typeof e)return e;var f=b.commands[a].defaultValue;return f?f[d]:void 0},g=function(c,d,e){if(e&&e.tagName)return e.tagName;var f=b.commands[c];return f.applierTagName?$.isPlainObject(f.applierTagName)?f.applierTagName[d]:f.applierTagName:f.tagName?f.tagName:f.commandType===a.commandType.inline?b.defaultInlineTag:b.defaultBlockTag},h=function(c,e){var h=d(c,e),i=b.commands[c],j={textArea:this,commandAttrType:h,commandName:c,tagName:i.tagName,applierTagName:g(c,h,e)},k=f(c,h,e);switch(h){case a.commandAttrType.className:j.classNameRegex=i.classNameRegex,j.className=k;break;case a.commandAttrType.styleName:j.styleName=i.styleName,j.styleValue=k}return $.extend(e,j)};$.extend($.Arte.TextArea.prototype,{bold:function(a){e.apply(this,["bold",a])},italic:function(a){e.apply(this,["italic",a])},underline:function(a){e.apply(this,["underline",a])},blockquote:function(){e.apply(this,["blockquote"])},h1:function(){e.apply(this,["h1"])},h2:function(){e.apply(this,["h2"])},h3:function(){e.apply(this,["h3"])},h4:function(){e.apply(this,["h4"])},h5:function(){e.apply(this,["h5"])},h6:function(){e.apply(this,["h6"])},subscript:function(){e.apply(this,["subscript"])},superscript:function(){e.apply(this,["superscript"])},fontSize:function(a){e.apply(this,["fontSize",a])},fontFamily:function(a){e.apply(this,["fontFamily",a])},color:function(a){e.apply(this,["color",a])},backgroundColor:function(a){e.apply(this,["backgroundColor",a])},unorderedList:function(a){e.apply(this,["unorderedList",a])},orderedList:function(a){e.apply(this,["orderedList",a])},textAlign:function(a){e.apply(this,["textAlign",a])},toggleStyleOnElement:function(a){var b=a.element||this.$el;if(a&&a.styleName){var c=$.Arte.dom.getStyles(b);a.styleValue===c[a.styleName]&&(a.styleValue=""),b.css(a.styleName,a.styleValue)}if(a&&a.className){var d=b.hasClass(a.className)?"removeClass":"addClass";b[d](a.className)}}})}(),function(a){a.Arte=a.Arte||{},a.Arte.util={isSelectionInElement:function(a){var b=rangy.getSelection(),c=b.getAllRanges()[0];return c&&(c.startContainer===a.get(0)||0!==a.has(c.startContainer).length)},moveCursorToEndOfElement:function(a){var b=new rangy.createRangyRange;b.selectNodeContents(a),b.collapse();var c=rangy.getSelection();c.setSingleRange(b)},all:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!!d}),d},any:function(b,c){var d=!0;return a.each(b,function(a,b){return d=c(a,b),!d}),d},filterCollection:function(b,c){var d=[];return a.each(b,function(a,e){c(a,e)&&d.push(b.length?e:a)}),d},getSelectedTextNodes:function(b){var c,d=a(),e=rangy.getSelection(),f=a.Arte.util.isSelectionInElement(this.$el);if(e.isCollapsed||!f){if(b&&f)return c=e.getRangeAt(0),d.push(c.startContainer),d;c=rangy.createRangyRange(),c.selectNodeContents(this.$el.get(0)),d=rangy.util.getTextNodes(c)}else f&&(c=e.getAllRanges()[0],d=rangy.util.getTextNodes(c));return d},getCommandConfig:function(b){var c=null,d=null,e=a.Arte.configuration,f=a.Arte.constants,g=function(a,c){return c===b.tagName};if(b&&b.commandName)return e.commands[b.commandName];for(var h in e.commands){var i=e.commands[h];if(b.className&&i.classNameRegex&&i.classNameRegex.test(b.className)?(c=i,d=f.commandAttrType.className):b.styleName&&b.styleName===i.styleName?(c=i,d=f.commandAttrType.styleName):!b.tagName||b.className||b.styleName||(a.isPlainObject(i.tagName)?a.Arte.util.any(i.tagName,g)&&(c=i):b.tagName===i.tagName&&(c=i),d=f.commandAttrType.tagName),c)return a.extend({commandAttrType:d},c)}return null}}}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b=a.Arte.dom,c=a.Arte.configuration,d=a.Arte.constants,e=a.Arte.util;a.extend(c,{styleableTags:{SPAN:1,DIV:1,P:1,LI:1,UL:1,OL:1},supportedTags:{P:1,UL:1,OL:1,LI:1,SPAN:1,BR:1}}),a.extend(c,{cleanup:{options:{removeNonPrintableCharacters:!0,removeEmptyElements:!0,removeRedundantMarkup:!0,mergeAdjacentLists:!0},invalidTagHandlers:{B:{applierTagName:"span",styleName:"font-weight",styleValue:"bold"},I:{applierTagName:"span",styleName:"font-style",styleValue:"italic"},U:{applierTagName:"span",styleName:"text-decoration",styleValue:"underline"},DIV:{applierTagName:"P"}},mergableTags:{SPAN:{SPAN:1,DIV:1,P:1,LI:1},DIV:{DIV:1,P:1,LI:1},P:{DIV:1,P:1,LI:1},LI:{},OL:{},UL:{},B:{B:1},U:{U:1},I:{I:1},STRONG:{STRONG:1},SUB:{SUB:1},SUP:{SUP:1},H1:{H2:1,H3:1,H4:1,H5:1,H6:1},H2:{H1:1,H3:1,H4:1,H5:1,H6:1},H3:{H1:1,H2:1,H4:1,H5:1,H6:1},H4:{H1:1,H2:1,H3:1,H5:1,H6:1},H5:{H1:1,H2:1,H3:1,H4:1,H6:1},H6:{H1:1,H2:1,H3:1,H4:1,H5:1}},invalidCharacterRegex:["\x00-","-"," -‏","-"]}});var f,g=c.cleanup,h=function(c,d){for(var e=function(b,c){return!a(c).is(":emptyTextOrRangySpan")};d.length;){var f=a(d[d.length-1]);d.splice(d.length-1,1);var g=b.prevSiblingIncludingTextNodes(f,e);g&&g.prop("tagName")===c&&(f.children().appendTo(g),f.remove())}},i=function(b){b.each(function(){h(d.tagName.OL,a(this).find(d.tagName.OL)),h(d.tagName.UL,a(this).find(d.tagName.UL))})},j={Next:0,Prev:1},k=function(c,d,e){var f=a(),g=d==j.Next?"nextSiblingIncludingTextNodes":"prevSiblingIncludingTextNodes",h=b[g](c,e);return h.length&&h.is(":element")&&!h.is(":block")&&c.prop("tagName")===h.prop("tagName")&&b.hasSameStyleAndClass(c,h)&&f.push(h[0]),f},l=function(a,b){return k(a,j.Prev,b)},m=function(b){return b.contents().filter(function(b,c){return!a(c).is(":emptyTextOrRangySpan")})},n=function(d,f){var g=m(d);if(!c.styleableTags[d.prop("tagName")])return!1;var h=g.filter(function(){return a(this).is(":element")});h.each(function(){var c=a(this),h=b.getStyles(c),i=b.getClasses(c);1===g.length?(a.each(h,function(a,b){d.css(a,b),c.css(a,"")}),a.each(i,function(a,c){var f=e.getCommandConfig({className:c});f&&f.classNameRegex&&b.removeClassWithPattern(d,f.classNameRegex),d.addClass(c),g.removeClass(c)})):(a.each(h,function(a,c){var h=e.getCommandConfig({styleName:a}),i={commandName:h.commandName,styleName:a,styleValue:c,topEditableParent:f.topEditableParent};b.closestWithCommandValue(g,i).length===g.length&&(d.css(a,c),g.css(a,""))}),a.each(i,function(a,c){if(b.allHaveClass(g,c)){var f=e.getCommandConfig({className:c});f.classNameRegex&&b.removeClassWithPattern(d,f.classNameRegex),d.addClass(c),g.removeClass(c)}}))})},o=function(b){for(var c=m(b),d=1;d<c.length;d++){var e=a(c[d]);if(e.is(":element")&&!e.is(":block")){var f=l(e);f.get(0)&&(f.append(e.contents()),e.remove())}}},p=function(c,d){var f=m(c),h=f.filter(function(){var b=a(this),d=g.mergableTags[b.prop("tagName")];return b.is(":element")&&(!b.is(":block")||1===f.length)&&d&&d[c.prop("tagName")]});h.each(function(){var c=a(this),f=b.getStyles(c),g=b.getClasses(c),h=e.all(f,function(a,d){var f=e.getCommandConfig({styleName:a}),g=b.closestWithCommand(c.parent(),{commandName:f.commandName,styleName:a});return g.get(0)&&b.getStyles(g)[a]===d}),i=c.parentsUntil(d.topEditableParent.parentNode),j=e.all(g,function(a,b){return i.hasClass(b)});return h&&j?void c.contents().first().unwrap():void 0})},q=function(c,d){var f=m(c),g=b.getStyles(c);a.each(g,function(g,h){var i=e.all(f,function(c,d){return b.getStyles(a(d))[g]})||b.closestWithCommandValue(c.parent(),{styleName:g,styleValue:h,topEditableParent:d.topEditableParent}).length>0;i&&c.css(g,"")});var h=b.getClasses(c);a.each(h,function(d,g){var h=e.getCommandConfig({className:g}),i=h&&h.classNameRegex&&e.all(f,function(c,d){return b.hasClassWithPattern(a(d),h.classNameRegex)})||c.parents().hasClass(g);i&&c.removeClass(g)})},r=function(b,c){b.each(function(){var b=a(this);if(b.is(":element")){var d=m(b);r(d,c),n(b,c),q(b,c),o(b,c),p(b,c)}})},s=function(a){var c=a.parent();a.is(":block")&&b.nextSiblingIncludingTextNodes(a).length&&b.prevSiblingIncludingTextNodes(a).length&&a.before("<br />"),a.remove(),c.is(":empty")&&s(c)},t=function(b){var c=b.find(":empty").not("br").not(":rangySpan");c.each(function(){s(a(this))})},u=function(b){b.find("."+c.rangySelectionBoundaryClassName).each(function(){1===a(this).parent().contents().length&&a(this).unwrap()})},v=function(a){var b=a.topEditableParent.innerHTML;f=f||new RegExp("["+g.invalidCharacterRegex.join("")+"]","g"),a.topEditableParent.innerHTML=b.replace(f,"")},w=function(c,d){d=a.extend({},g.options,d),d.topEditableParent||(d.topEditableParent=b.getTopEditableParent(c).get(0)),u(c),d.removeNonPrintableCharacters&&v(d),d.removeEmptyElements&&t(c),d.mergeAdjacentLists&&i(c),d.removeRedundantMarkup&&r(c,d)},x=function(b){for(var d=0;d<b.length;d++){var e=b[d];if(e.nodeType!=a.Arte.constants.nodeType.TEXT){if(!c.supportedTags[e.tagName])return!0;if(x(a(e).contents()))return!0}}return!1},y=function(b){b.each(function(){if(this.nodeType!=a.Arte.constants.nodeType.TEXT){var b=a(this);y(b.contents());var d=this.tagName;if(!c.supportedTags[d]){var e=g.invalidTagHandlers[d]||{tagName:"P"},f=a.Arte.dom.createContainer(e).html(b.html());b.replaceWith(f)}}})};b.hasUnsanctionedElements=x,b.handleUnsanctionedElements=y,b.cleanup=w}(jQuery),function(a){a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var b=a.Arte.dom,c=a.Arte.configuration,d=a.Arte.constants;a.extend(b,{wrapWithOptions:function(d,e){var f=a();if(d.length>0){f=b.createContainer(e);var g=b.prevSiblingIncludingTextNodes(d.first());g.hasClass(c.rangySelectionBoundaryClassName)&&f.append(g);var h=b.nextSiblingIncludingTextNodes(d.last());d.first().before(f),d.each(function(){f.append(this)}),h.hasClass(c.rangySelectionBoundaryClassName)&&f.append(h)}return f},unwrapWithOptions:function(c,d){var e=a();return c.each(function(){var c=a(this),f=function(b,c){return!a(c).is(":emptyTextOrRangySpan")};if(c.is(":block")){var g=b.prevSiblingIncludingTextNodes(c,f);g.length&&!g.is(":block")&&d&&d.insertBr&&c.before(a("<br />"));var h=b.nextSiblingIncludingTextNodes(c,f);h.length&&!h.is(":block")&&d&&d.insertBr&&c.after(a("<br />"))}var i=a(this).contents();if(d&&d.maintainStyles){var j=b.wrapWithOptions(i,{applierTagName:"span",attr:{style:c.attr("style")}});j.unwrap(),e=e.add(j)}else i.first().unwrap(),e=e.add(i)}),e},wrapWithBlock:function(a,e){var f,g=b.closestWithAtMostOneBlockChild(a,e.topEditableParent),h=g.prop("tagName");g.first().is(":block")&&e.applierTagName!==d.tagName.LI&&c.styleableTags[h]?h===e.applierTagName||c.styleableTags[h]&&c.styleableTags[e.applierTagName]?e.styleName?g.css(e.styleName,e.styleValue):e.className?g.addClass(e.className):f=g:f=a:f=g;var i=f?b.wrapWithOptions(f,e):g,j=i.next();return j.length&&j.prop("tagName")==d.tagName.BR&&j.remove(),i},unwrapBlock:function(c,d){var e=b.closestWithCommand(c,d);return e.length?!a.isEmptyObject(b.getStyles(e))||b.getClasses(e).length>0||e.attr("contentEditable")?d.styleName?e.css(d.styleName,""):d.className?e.removeClass(d.className):void 0:b.unwrapWithOptions(e,{insertBr:!0}):c},createContainer:function(b){var c=b.applierTagName||"div",d=a("<"+c+">");return b.attr&&d.attr(b.attr),b.styleName&&b.styleValue&&d.css(b.styleName,b.styleValue),b.className&&d.addClass(b.className),d}})}(jQuery),function(a){function b(b,c,d){var e=a(),f=c===g.Next;return b.each(function(){for(var b,c=a(this).parent().contents().get(),g=a.inArray(a(this).get(0),c),h=f?1:-1,i=g+h;f?i<c.length:i>=0;i+=h){var j=d?d(i,c[i]):!0;if(j){b=c[i];break}}b&&e.push(b)}),e}a.Arte=a.Arte||{},a.Arte.dom=a.Arte.dom||{};var c=a.Arte.dom,d=a.Arte.constants,e=a.Arte.configuration,f=a.Arte.util;a.extend(a.expr[":"],{block:function(b){return 3!==b.nodeType&&(b&&"BR"===b.tagName||("block"===a(b).css("display")||"list-item"===a(b).css("display"))&&"none"===a(b).css("float"))},element:function(a){return a.nodeType===d.nodeType.ELEMENT},emptyText:function(a){return 3===a.nodeType&&null!==a.nodeValue.match(/^\s*$/gi)},rangySpan:function(b){return a(b).hasClass(e.rangySelectionBoundaryClassName)},emptyTextOrRangySpan:function(b){var c=a(b);return c.is(":emptyText")||c.is(":rangySpan")},blockChildren:function(b){return a(b).children().not(this).filter(":block").length>0}});var g={Next:0,Prev:1};document.documentElement.contains&&(jQuery.contains=function(a,b){if(a===b)return!1;if(3===a.nodeType)return!1;var c=b.parentNode||{};return a===c||(1===c.nodeType?!a.contains||a.contains(c):a!==b&&a.contains?a.contains(b):!0)}),a.extend(c,{closestWithAtMostOneBlockChild:function(b,c){var d=[];return b.each(function(){var b=null;a(this).parentsUntil(c).each(function(){var c=a(this).children(":block").length,d=0===c||1===c&&c===this.childNodes.length;return d&&(b=this),d});var e=b||this;-1===a.inArray(e,d)&&d.push(e)}),a(d)},prevSiblingIncludingTextNodes:function(a,c){return b(a,g.Prev,c)},nextSiblingIncludingTextNodes:function(a,c){return b(a,g.Next,c)},getClasses:function(a){var b=[],c=a.attr("class");return c&&(b=c.split(/\s+/)),b},getStyles:function(b){var c={};if(b.prop("nodeType")===d.nodeType.TEXT)return c;var e=b.attr("style"),f=e?e.toLowerCase().split(";"):[];return a.each(f,function(b,d){if(d=a.trim(d),!d)return!0;var e=d.indexOf(":"),f=a.trim(d.substring(0,e)),g=a.trim(d.substring(e+1));g&&(c[f]=g)}),c},hasCommandApplied:function(b,f){var g=!1,h=e.commands[f];return b.each(function(){var b=a(this);if(this.nodeType===d.nodeType.TEXT)return g=!1;var e=c.getStyles(b);return g=h.classNameRegex&&c.hasClassWithPattern(b,h.classNameRegex)||h.styleName&&e[h.styleName]||h.tagName&&this.tagName===h.tagName}),g},hasCommandValue:function(b,d){var e=!1;return b.each(function(){var b=a(this);return e=d.className&&b.hasClass(d.className)||d.styleName&&c.getStyles(b)[d.styleName]===d.styleValue||d.tagName&&b.prop("tagName")===d.tagName}),e},getCommandValue:function(b,d){var f={},g=e.commands[d.commandName];return b.each(function(){var b=a(this),e=c.getStyles(b);return d.className&&b.hasClass(d.className)?f.className=d.className:c.hasClassWithPattern(b,g.classNameRegex)?f.className=c.getClassWithPattern(b,g.classNameRegex)[0]:d.styleName&&e[d.styleName]?f.styleName=e[d.styleName]:d.tagName&&b.prop("tagName")===g.tagName&&(f.tagName=b.prop("tagName")),f}),f},hasClassWithPattern:function(a,b){return b.test(a.attr("class"))},getClassWithPattern:function(a,b){return b.exec(a.attr("class"))},removeClassWithPattern:function(b,d){var e=c.getClassWithPattern(b,d)||[];a.each(e,function(a,c){b.removeClass(c)})},hasSameListParent:function(a){var b=a.first().closest(d.tagName.LI).parent();if(0===b.length)return!1;var c=!0;return a.each(function(){return c=0!==b.has(this).length}),c},allHaveClass:function(b,c){var d=!0;return b.each(function(){return d=a(this).hasClass(c)}),d},hasSameClass:function(b,d){var e={},g={};return a.each(c.getClasses(b),function(){e[this]=1}),a.each(c.getClasses(d),function(){g[this]=1}),f.all(e,function(a){return g[a]})&&f.all(g,function(a){return e[a]})},hasSameStyle:function(a,b){var d=c.getStyles(a),e=c.getStyles(b);return f.all(d,function(a,b){return e[a]===b})&&f.all(e,function(a,b){return d[a]===b})},hasSameStyleAndClass:function(a,b){return c.hasSameStyle(a,b)&&c.hasSameClass(a,b)},closestWithCommandValue:function(b,d){return c.closestWithCommand(b,a.extend(d,{checkValue:1}))},closestWithCommand:function(b,d){var e=a(),g=f.getCommandConfig(d);return g?(b.each(function(){var b=a(this),f=d.topEditableParent||c.getTopEditableParent(b).get(0);if(f){var h=b.parentsUntil(f.parentNode);h.splice(0,0,this),h.each(function(){return c.hasCommandApplied(a(this),g.commandName)?((!d.checkValue||c.hasCommandValue(a(this),d))&&e.push(this),!1):!0})}}),e):e},getTopEditableParent:function(a){var b=a.closest("[contenteditable=true]");return b.length?b:a.closest("textarea")},listSurrounded:function(b,c){var e=f.all(b,function(b,c){return a(c).closest(d.tagName.LI).parents("[contenteditable=true]").get(0)});if(e){var g=b.closest(d.tagName.LI).parent();if(c&&c.singleList&&g.length>1)return!1;if(c&&c.tagName){var h=!1;return g.each(function(a,b){return h=b.tagName===c.tagName}),h}return!0}return!1},isEqual:function(b,c){if(!b.get(0)||!c.get(0))return!1;var d=!0,e=["style","id","class"];if(b.prop("tagName")===c.prop("tagName")){if(a.each(e,function(e,f){if("style"===f)d=a.Arte.dom.hasSameStyle(b,c);else if("class"===f)d=a.Arte.dom.hasSameClass(b,c);else{var g=b.attr(f)&&a.trim(b.attr(f)),h=c.attr(f)&&a.trim(c.attr(f));d=g===h}return d}),d){var f=function(b,c){return!a(c).is(":emptyText")},g=b.contents().filter(f),h=c.contents().filter(f);d=g.length===h.length;for(var i=0,j=g.length;j>i&&d;i++)d=3===g[i].nodeType?a.trim(g[i].nodeValue)===a.trim(h[i].nodeValue):a.Arte.dom.isEqual(a(g[i]),a(h[i]))}}else d=!1;return d}})}(jQuery),rangy.createModule("BlockElementApplier",["WrappedSelection","WrappedRange"],function(a){function b(a,b){for(var c,d=a.length,f=new p,g=e(a),h=0;d>h;h++)c=n.closestWithCommandValue(g[h],b).length>0?f.surroundedIndexes:f.unSurroundedIndexes,c.push(h);return f}function c(a,c){var d=b(a,{tagName:o.tagName.LI,commandAttrType:c.commandAttrType,topEditableParent:c.topEditableParent});if(d.state()===d.Surrounded){var e=$();if($.each(a,function(a,b){var c=$(rangy.util.getTopNodes(b.getNodes())).closest(o.tagName.LI);e.push(c.get(0))}),n.hasSameListParent(e)){var f=e.first().parent();f.prop("tagName")!==c.applierTagName.toUpperCase()&&d.state(d.UnSurrounded)}else d.state(d.Mixed)}return d}function d(a,b){var c=a.children(),d=$(),e=$(),f=$(),g=d;return c.each(function(){return b.originalRange.intersectsNode(this)?(g=f,e.push(this),!0):(g.push(this),!0)}),{tagName:a.prop("tagName"),beforeSelection:d,selection:e,afterSelection:f}}function e(a){for(var b={},c=function(){b[d].push(this)},d=0;d<a.length;d++)b[d]=$(),$(rangy.util.getTopNodes(a[d].getNodes())).each(c);return b}function f(a,b){var c,e=b.blockSurroundState,f=function(a){var b=n.wrapWithBlock;b(a.beforeSelection,{applierTagName:a.tagName}),b(a.afterSelection,{applierTagName:a.tagName})},g=function(a){var c=a.closest(o.tagName.LI).parent(),e=d(c,b);return{parent:c,selectionResult:e}};0===e.surroundedIndexes[0]&&(c=g($(a[0].startContainer)));var h,i=a.length;e.surroundedIndexes[e.surroundedIndexes.length-1]===i-1&&(h=g($(a[i-1].startContainer))),c&&(n.unwrapWithOptions(c.parent),f(c.selectionResult)),!h||c&&c.parent[0]===h.parent[0]||(n.unwrapWithOptions(h.parent),f(h.selectionResult))}function g(a,b){var c=b.blockSurroundState,d=e(a),g=$();f(a,b);var h={};$.each(c.surroundedIndexes,function(){h[this]=1});for(var i=function(){g.push(this)},j=a.length,k=0;j>k;k++){var l;if(h[k]){var m=d[k].first().closest(o.tagName.LI);if(!m.parents(o.tagName.OL)[0]&&!m.parents(o.tagName.UL)[0]){g.push(m[0]);continue}m.parent().children().each(i),n.unwrapWithOptions(m.parent())}else{if(3==d[k][0].nodeType&&65279==d[k][0].nodeValue.charCodeAt(0))continue;l=n.wrapWithBlock(d[k],{applierTagName:o.tagName.LI,topEditableParent:b.topEditableParent}),g.push(l[0])}}n.wrapWithOptions(g,b)}function h(a,b){var c=$(a[0].startContainer).closest(o.tagName.LI).parent(),e=c.prop("tagName"),f=d(c,b);n.unwrapWithOptions(c),n.wrapWithOptions(f.beforeSelection,{applierTagName:e}),n.unwrapWithOptions(f.selection,{insertBr:!0,maintainStyles:!0}),n.wrapWithOptions(f.afterSelection,{applierTagName:e})}function i(a,b){if(!b)return a;var c=rangy.createRangyRange();c.selectNodeContents(b);for(var d=c.splitByBlock(),e=a.cloneRange(),f=0,g=d.length;g>f;f++)e.intersectsRange(d[f])&&(0===d[f].comparePoint(e.startContainer,e.startOffset)&&e.setStart(d[f].startContainer,d[f].startOffset),0===d[f].comparePoint(e.endContainer,e.endOffset)&&e.setEnd(d[f].endContainer,d[f].endOffset));return e}function j(a,b){var d=new $.Arte.ElementApplierOptions(b),e=i(a,b.topEditableParent);d.originalRange=e;var f=e.splitByBlock(),j=c(f,d);d.blockSurroundState=j,j.state()===j.UnSurrounded||j.state()===j.Mixed?g(f,d):j.state()===j.Surrounded&&h(f,d)}function k(a,b){var c=new $.Arte.ElementApplierOptions(a,b),d=rangy.getSelection(),e=d.getRangeAt(0);e&&j(e,c)}function l(a,c){if(!a.isCollapsed){var d=new $.Arte.ElementApplierOptions(c),f=i(a,c.topEditableParent),g=f.splitByBlock(),h=b(g,d),j=e(g);for(var k in j){var l=j[k];h.state()==h.Surrounded?n.unwrapBlock(l,d):n.wrapWithBlock(j[k],d)}}}function m(a,b){var c=new $.Arte.ElementApplierOptions(a,b),d=rangy.getSelection(),e=d.getRangeAt(0);e&&l(e,c)}var n=$.Arte.dom,o=$.Arte.constants,p=function(){this.Surrounded=0,this.UnSurrounded=1,this.Mixed=2,this.Invalid=3,this.surroundedIndexes=[],this.unSurroundedIndexes=[],this._state="",this.computeState=function(){return this._state=this.surroundedIndexes.length&&!this.unSurroundedIndexes.length?this.Surrounded:this.unSurroundedIndexes.length&&!this.surroundedIndexes.length?this.UnSurrounded:this.surroundedIndexes.length&&this.unSurroundedIndexes.length?this.Mixed:this.Invalid,this._state},this.state=function(a){return a&&(this._state=a),this._state||(this._state=this.computeState()),this._state}};a.toggleSurroundRange=l,a.toggleSurroundSelection=m,a.toggleSurroundRangeSet=j,a.toggleSurroundSelectionSet=k}),function(a){a.Arte=a.Arte||{},a.Arte.ElementApplierOptions=function(b){if(b._isProcessed)return b;var c=a.Arte.constants;switch(this.tagName="",this.topEditableParent="",this.commandName="",this.commandAttrType=b.commandAttrType,this.textArea=null,this.commandAttrType){case c.commandAttrType.className:this.classNameRegex="",this.className="";break;case c.commandAttrType.styleName:this.styleName="",this.styleValue=""}for(var d in b)this[d]=b[d];if(this.tagName&&(this.tagName=a("<"+this.tagName+">").prop("tagName")),this.attr={},this.commandAttrType==c.commandAttrType.className&&(this.attr["class"]=this.className),this.commandAttrType==c.commandAttrType.styleName){var e=a("<div>").css(this.styleName,this.styleValue);this.attr.style=e[0].style.cssText}if(!this.commandName){var f=a.Arte.util.getCommandConfig(this);f&&(this.commandName=f.commandName,this.commandAttrType=f.commandAttrType)}this._isProcessed=!0}}(jQuery),$(document).ready(function(){function a(a){var c=a.rangeInfos[0];if(c.collapsed)return null;var d=$("#"+c.startMarkerId)[0],e=$("#"+c.endMarkerId)[0];return b(d,e)}function b(a,b,c){var d=rangy.createRangyRange(),e=c?"setStartAfter":"setStartBefore",f=c?"setEndBefore":"setEndAfter";return d[e](a),d[f](b),d}function c(a){return a.collapsed?void 0:$(a.getNodes([3])).filter(function(){return!g(this)})}rangy.init(),rangy.rangePrototype.splitByBlock=function(){var a=[],b=this.cloneRange();
if(b.collapsed)return b;for(var c,d=b.getNodes([3,1],function(a){return i(a)||3===a.nodeType&&!g(a)}),e=null;d.length>0;)if(1!==d[0].nodeType)if(e&&!$(e).has(d[0]).length&&(e=null),d[0].parentNode.childNodes.length>1||!i(f(d[0]))){c=rangy.createRangyRange(),c.setStartBefore(d[0]);for(var h=0,j=d.length;j>h;h++)if(1!==d[h].nodeType){if(i(d[h].nextSibling)||!d[h].nextSibling&&i(d[h].parentNode)||d[h+1]&&i(d[h+1])){c.setEndAfter(d[h]);break}if(e&&!$(e).has(d[h+1]).length){c.setEndAfter(d[h]);break}}c.startContainer===c.endContainer&&c.startOffset===c.endOffset&&(h--,c.setEndAfter(d[h])),a.push(c),d.splice(0,h+1)}else i(f(d[0]))&&(c=rangy.createRangyRange(),c.selectNodeContents(d[0]),a.push(c),d.splice(0,1));else e&&$(e).has(d[0]).length||(e=d[0]),d.splice(0,1);return a};var d,e=function(a){for(var b=[],c=0,d=a.length;d>c;c++){for(var e=!1,f=0,g=a.length;g>f;f++)if($.contains(a[f],a[c])){e=!0;break}e||b.push(a[c])}return b},f=function(a){return 1===a.parentNode.childNodes.length?f(a.parentNode):a},g=function(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b||"﻿"===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;var e=d(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(e)||/^[\t\r ]+$/.test(b)&&"pre-line"==e};if("undefined"!=typeof window.getComputedStyle)d=function(a,b){return rangy.dom.getWindow(a).getComputedStyle(a,null)[b]};else{if("undefined"==typeof document.documentElement.currentStyle)throw new Error("Can't create getComputedStyleProperty");d=function(a,b){return a.currentStyle[b]}}var h=/^(none|inline(-block|-table)?)$/i,i=function(a){if(!a)return!1;var b=a.nodeType;return 1==b&&(!h.test(d(a,"display"))||"BR"===a.tagName)||9==b||11==b};rangy.util.getRangeFromSavedSelection=a,rangy.util.createRangeFromElements=b,rangy.util.getTextNodes=c,rangy.util.isWhitespaceNode=g,rangy.util.isBlockOrLineBreak=i,rangy.util.getTopNodes=e,rangy.util.getTopParentWithSingleChild=f}),rangy.createModule("InlineElementApplier",["WrappedSelection","WrappedRange"],function(a){function b(){return!$(this).hasClass("rangySelectionBoundary")}function c(a,b){var c=rangy.util.getTextNodes(a);return j.closestWithCommandValue(c,b).length===c.length}function d(a,c){var d=a.parent(),e=d.contents().filter(b);if(e.length>1||!k.styleableTags[d.prop("tagName")]||c.commandAttrType===l.commandAttrType.tagName)j.wrapWithOptions(a,c);else if(c.commandAttrType===l.commandAttrType.styleName)d.css(c.styleName,c.styleValue);else if(c.commandAttrType===l.commandAttrType.className){var f=m.getCommandConfig({className:c.className});f&&f.classNameRegex&&j.removeClassWithPattern(d,f.classNameRegex),d.addClass(c.className)}}function e(a,b){rangy.util.getTextNodes(a).each(function(){d($(this),b)})}function f(a,b){var c=j.closestWithCommand(a,$.extend(b,{checkValue:!0})),d=rangy.createRangyRange();d.selectNodeContents(c[0]);var e=m.filterCollection(rangy.util.getTextNodes(d,!0),function(b,c){return c!==a.get(0)});if($.each(e,function(a,c){j.wrapWithOptions($(c),b)}),b.styleName&&j.hasCommandValue(c,{styleName:b.styleName,styleValue:b.styleValue})){var f=new RegExp(b.styleName+"\\s?:\\s?"+b.styleValue+"\\s?;?","i");c[0].style.cssText=c[0].style.cssText.replace(f,"")}else b.className&&j.hasCommandValue(c,{className:b.className})?c.removeClass(b.className):j.unwrapWithOptions(c,b)}function g(a,b){rangy.util.getTextNodes(a).each(function(){f($(this),b)})}function h(a,b){if(a.collapsed)return a;var d=new $.Arte.ElementApplierOptions(b),f=c(a,d);f?g(a,d):e(a,d)}function i(a){var b=new $.Arte.ElementApplierOptions(a),c=rangy.getSelection();if(!c.isCollapsed){var d=rangy.saveSelection(),e=d.rangeInfos[0],f=$("#"+e.startMarkerId),g=$("#"+e.endMarkerId),i=rangy.util.createRangeFromElements(f.get(0),g.get(0),!0);c.setSingleRange(i),f.remove(),g.remove()}var j=rangy.getSelection().getRangeAt(0);j&&h(j,b)}var j=$.Arte.dom,k=$.Arte.configuration,l=$.Arte.constants,m=$.Arte.util;a.toggleStyleOnRange=h,a.toggleStyleOnSelection=i}),function(a){a.Arte=a.Arte||{},a.Arte.RichTextCommandApplier=function(b){var c=a.Arte.dom,d=a.Arte.util,e=a.Arte.constants,f=a.Arte.configuration,g=function(b,f){var g=rangy.getSelection(),h=b.textArea,i=d.isSelectionInElement(h.$el),j=null;if(g.isCollapsed){var k,l=g.getAllRanges()[0];l&&i?(k=l.startContainer,k=k.nodeType===e.nodeType.TEXT?k.parentNode:k):k=h.$el.get(0),j=rangy.util.createRangeFromElements(k,k)}var m=h.$el,n=m.get(0),o={topEditableParent:n};a.extend(o,b);var p=e.commandType,q=null;switch(f){case p.inline:q=function(){return j?rangy.toggleStyleOnRange(j,o):rangy.toggleStyleOnSelection(o)};break;case p.block:q=function(){return j?rangy.toggleSurroundRange(j,o):rangy.toggleSurroundSelection(o,n)};break;case p.complex:q=function(){return j?rangy.toggleSurroundRangeSet(j,o):rangy.toggleSurroundSelectionSet(o,n)}}var r=rangy.saveSelection();q(),c.cleanup(a(o.topEditableParent)),rangy.restoreSelection(r)},h=function(a,b){var c=a.textArea,h=e.editorTypes,i=c.editorType===h.plainText||!c.$el.html(),j=d.isSelectionInElement(c.$el);(j||!f.requireFocus)&&(j||f.requireFocus||"tagName"==a.commandAttrType||(i=!0),i?c.toggleStyleOnElement(a):g(a,b))};this.execute=function(){if(!b.commandName)throw"commandName not specified.";var a=f.commands[b.commandName];if(!a)throw"unrecognized command: "+b.commandName;h(b,a.commandType)}},a.Arte.RichTextCommandApplier.createAndExecute=function(b){var c=new a.Arte.RichTextCommandApplier(b);return c.execute(),c}}(jQuery),function(a){var b=function(){var a={insert:function(a){if($.extend(a,{execute:!0}),this.triggerEvent($.Arte.constants.eventNames.onbeforeinsert,a),a.execute){var b=$.Arte.util.isSelectionInElement(this.$el);if(b||!$.Arte.configuration.requireFocus){var c,d=$("<span>").html(a.commandValue).get(0);if(b){c=rangy.getSelection();var e=c.getAllRanges()[0];c.isCollapsed||e.deleteContents(),e.collapse(),e.insertNode(d)}else this.$el.append(d);c=rangy.getSelection(),c.setSingleRange(rangy.util.createRangeFromElements(d,d)),this.triggerEvent($.Arte.constants.eventNames.onafterinsert,a)}}}};return $.extend($.Arte.TextArea.prototype,a),$.extend($.Arte.constants.eventNames,{onbeforeinsert:"onbeforeinsert",onafterinsert:"onafterinsert"}),{init:function(){}}};a.register("insertCommand",b)}($.Arte.pluginManager),function(a){var b=$.Arte.constants,c=function(a,b){var c=null,d=!0,e=$.Arte.dom.closestWithCommand(a,b);if(a.length!==e.length)return null;var f=$.Arte.dom.getCommandValue(e.first(),b);if(e.each(function(){return d=$.Arte.dom.hasCommandValue($(this),f)}),d)for(var g in f)c=f[g];return c},d=function(a,c){var d=c.tagName;if(d&&(d===b.tagName.OL||d===b.tagName.UL))return $.Arte.dom.listSurrounded(a,{singleList:!0,tagName:d});var e=$.Arte.dom.closestWithCommandValue(a,c);return e.length===a.length},e=function(a,b,e){if(!a||!a.length)return null;var f=$.Arte.configuration.commands[b],g=$.extend({commandName:b,tagName:f.tagName,styleName:f.styleName,styleValue:f.defaultValue?f.defaultValue.styleName:null,className:f.defaultValue?f.defaultValue.className:null},e);return f.acceptsParams?c(a,g):d(a,g)},f=function(a,c){if(c)return e(a,c);var d={};return $.each($.Arte.configuration.commands,function(c,f){$.isPlainObject(f)&&f.commandType&&f.commandType!=b.commandType.other&&(d[c]=e(a,c))}),d};$.extend($.Arte.TextArea.prototype,{getState:function(a){var b=$.Arte.util.getSelectedTextNodes.apply(this,[!0]);return f(b,a)},getAllStates:function(a){var b=$.Arte.util.getSelectedTextNodes.apply(this,[!0]),c=[];return $.each(b,function(){var b=$(this);c.push(f(b,a))}),c}});var g=function(){return{init:function(){}}};a.register("stateDetector",g)}($.Arte.pluginManager),function(a){var b=function(a){var b=a?this.hasUndo():this.hasRedo();if(b){var c=$.Arte.constants.eventNames,d={execute:!0};this.triggerEvent(a?c.onbeforeundo:c.onbeforeredo,d),d.execute&&(this.undoInfo.index+=a?-1:1,this.outerValue(this.undoInfo.stack[this.undoInfo.index])),this.triggerEvent(a?c.onundo:c.onredo,{})}},c=function(a,b){var c=b.textArea,d=c.undoInfo,e=$.trim(c.outerValue());if(e!=d.stack[d.index]){var f=++c.undoInfo.index,g=c.undoInfo.stack;g.splice(f,g.length),g.push(e)}},d={hasUndo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index>0},hasRedo:function(){return this.undoInfo.stack.length>0&&this.undoInfo.index<this.undoInfo.stack.length-1},undo:function(){b.call(this,!0)},redo:function(){b.call(this,!1)}};$.extend($.Arte.TextArea.prototype,d),$.extend($.Arte.constants.eventNames,{onbeforeundo:"onbeforeundo",onundo:"onundo",onbeforeredo:"onbeforeredo",onredo:"onredo"});var e=function(){return{init:function(a){a.undoInfo=a.undoInfo||{stack:[],index:-1},a.$element.on({onvaluechange:c})}}};a.register("undoManager",e)}($.Arte.pluginManager),function(a){var b=function(){var a={8:"BackSpace",13:"Enter",32:"Space",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",65:"A",66:"B",67:"C",73:"I",75:"K",85:"U",86:"V",88:"X"},b=function(){},c=function(b){var c=b.ctrlKey?"CTRL+":"";c+=b.altKey?"AlT+":"";var d=a[b.keyCode];return c+=d||""},d=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"CTRL+B":d.bold(),e.preventDefault();break;case"CTRL+I":d.italic(),e.preventDefault();break;case"CTRL+U":d.underline(),e.preventDefault()}},e=function(a,b){var d=b.textArea,e=b.originalEvent,f=c(e);switch(f){case"CTRL:A":case"CTRL+V":case"CTRL+ArrowDown":case"CTRL+ArrowLeft":case"CTRL+ArrowRight":case"CTRL+ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":d.triggerEvent($.Arte.constants.eventNames.onselectionchange)}};return{init:function(a){a.$element.on({onkeydown:d,onkeypress:b,onkeyup:e})}}};a.register("keyboardEventHandler",b)}($.Arte.pluginManager),function(a){$.Arte.configuration.pasteHandler={attributes:{id:1,style:1,"class":1},style:{font:1,"font-style":1,"font-weight":1,"font-family":1,color:1,"font-size":1,"text-align":1},tag:{P:1,DIV:1,UL:1,OL:1,LI:1,SPAN:1},nodeType:{1:1,3:1},invalidTagHandlers:{B:{applierTagName:"span",styleName:"font-weight",styleValue:"bold"},I:{applierTagName:"span",styleName:"font-style",styleValue:"italic"},U:{applierTagName:"span",styleName:"text-decoration",styleValue:"underline"},FONT:{applierTagName:"span"}}};var b=$.Arte.configuration.pasteHandler,c=$.Arte.configuration.classNameSpace,d=function(a){var d=a.get(0).nodeType;if(!b.nodeType[d])return a.remove(),null;if(d==$.Arte.constants.nodeType.TEXT){var e=a.get(0).nodeValue;return e=e.replace(/<!--[\S\s]*?-->/gi,""),""===e||!e.match(/\S+/gi)||e.match(/^[\xA0]+$/gi)?(a.remove(),null):(a.get(0).nodeValue=e.replace(/\n/gi,"").replace(/[\xA0|\s+]{2,}/gi," "),null)}var f=a.html();if(!f)return a.remove(),null;var g=a.prop("tagName");if(b.tag[g]){for(var h=a.prop("attributes"),i=0;i<h.length;i++)if(!b.attributes[h[i].name])try{a.removeAttr(h[i].name)}catch(j){}var k=$.Arte.dom.getClasses(a);$.each(k,function(b,d){0!==d.indexOf(c)&&a.removeClass(d)});var l="";return $.each($.Arte.dom.getStyles(a),function(a,c){var d=b.style[a];if(d)switch(a){case"font-size":d=c.match(/\d+\s?px/);break;case"color":d=c.match(/#[a-fA-F0-9]{6}/)||c.match(/rgb\(\d+,\s*\d+\,\s*\d+\)/)}d&&(l+=a+": "+c+"; ")}),a.get(0).style.cssText=l,null}var m=b.invalidTagHandlers[a.prop("tagName")]||{tagName:"DIV"},n=$.Arte.dom.createContainer(m).html(a.html());return n},e=function(a){a.each(function(){var a=$(this);e(a.contents());var b=d(a);b&&a.replaceWith(b)})};$.extend($.Arte.constants.eventNames,{onbeforehandlepaste:"onbeforehandlepaste",onhandlepaste:"onhandlepaste"});var f=function(){return{init:function(a){a.$element.on({onpaste:function(b,c){var d={execute:!0};a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d),d.execute&&(e(c.textArea.$el.children()),a.triggerEvent($.Arte.constants.eventNames.onbeforehandlepaste,d))}})}}};a.register("pasteHandler",f)}($.Arte.pluginManager);