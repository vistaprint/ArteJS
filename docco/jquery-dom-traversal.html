<!DOCTYPE html>

<html>
<head>
  <title>jquery-dom-traversal.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Arte.html">
                Arte.js
              </a>
            
              
              <a class="source" href="Commands.html">
                Commands.js
              </a>
            
              
              <a class="source" href="Configuration.html">
                Configuration.js
              </a>
            
              
              <a class="source" href="PluginManager.html">
                PluginManager.js
              </a>
            
              
              <a class="source" href="TextArea.html">
                TextArea.js
              </a>
            
              
              <a class="source" href="Util.html">
                Util.js
              </a>
            
              
              <a class="source" href="jquery-dom-cleanup.html">
                jquery-dom-cleanup.js
              </a>
            
              
              <a class="source" href="jquery-dom-manipulation.html">
                jquery-dom-manipulation.js
              </a>
            
              
              <a class="source" href="jquery-dom-traversal.html">
                jquery-dom-traversal.js
              </a>
            
              
              <a class="source" href="rangy-blockElementApplier.html">
                rangy-blockElementApplier.js
              </a>
            
              
              <a class="source" href="rangy-elementApplierOptions.html">
                rangy-elementApplierOptions.js
              </a>
            
              
              <a class="source" href="rangy-extensions.html">
                rangy-extensions.js
              </a>
            
              
              <a class="source" href="rangy-inlineElementApplier.html">
                rangy-inlineElementApplier.js
              </a>
            
              
              <a class="source" href="richtextCommandApplier.html">
                richtextCommandApplier.js
              </a>
            
              
              <a class="source" href="InsertCommand.html">
                InsertCommand.js
              </a>
            
              
              <a class="source" href="StateDetector.html">
                StateDetector.js
              </a>
            
              
              <a class="source" href="UndoManager.html">
                UndoManager.js
              </a>
            
              
              <a class="source" href="keyboardEventHandler.html">
                keyboardEventHandler.js
              </a>
            
              
              <a class="source" href="pasteHandler.html">
                pasteHandler.js
              </a>
            
              
              <a class="source" href="Button.html">
                Button.js
              </a>
            
              
              <a class="source" href="ButtonWithDialog.html">
                ButtonWithDialog.js
              </a>
            
              
              <a class="source" href="ButtonWithDropDown.html">
                ButtonWithDropDown.js
              </a>
            
              
              <a class="source" href="Configuration.html">
                Configuration.js
              </a>
            
              
              <a class="source" href="SelectionManager.html">
                SelectionManager.js
              </a>
            
              
              <a class="source" href="toolbar.html">
                toolbar.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery-dom-traversal.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @fileoverview This file includes a collection of extension to jQuery that allows complex traversals of dom tree
 */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> </span>{
    $.Arte = $.Arte || {};
    $.Arte.dom = $.Arte.dom || {};
    <span class="hljs-keyword">var</span> dom = $.Arte.dom;
    <span class="hljs-keyword">var</span> constants = $.Arte.constants;
    <span class="hljs-keyword">var</span> configuration = $.Arte.configuration;
    <span class="hljs-keyword">var</span> util = $.Arte.util;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Sizzle extension</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.extend($.expr[<span class="hljs-string">":"</span>], {
        <span class="hljs-comment">/**
         * Sizzle lis to find block level elements
         * Usage:
         * - $("body :block") // returns all block elements inside body tag.
         * - $(element).is(":block") // will check if element is block or not.
         */</span>
        block: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Check if computed display of the element is block and float is not set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> element.nodeType !== <span class="hljs-number">3</span> &amp;&amp; ((element &amp;&amp; element.tagName === <span class="hljs-string">"BR"</span>) || (($(element).css(<span class="hljs-string">"display"</span>) === <span class="hljs-string">"block"</span> ||
                $(element).css(<span class="hljs-string">"display"</span>) === <span class="hljs-string">"list-item"</span>) &amp;&amp; $(element).css(<span class="hljs-string">"float"</span>) === <span class="hljs-string">"none"</span>));
        },
        <span class="hljs-comment">/**
         * Checks if the jQuery node is an element
         * Usage: jElement.is(":element");
         */</span>
        element: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
            <span class="hljs-keyword">return</span> element.nodeType === constants.nodeType.ELEMENT;
        },
        emptyText: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
            <span class="hljs-keyword">return</span> element.nodeType === <span class="hljs-number">3</span> &amp;&amp; (element.nodeValue.match(<span class="hljs-regexp">/^\s*$/ig</span>) !== <span class="hljs-literal">null</span>);
        },
        rangySpan: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
            <span class="hljs-keyword">return</span> $(element).hasClass(configuration.rangySelectionBoundaryClassName);
        },
        emptyTextOrRangySpan: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{
            <span class="hljs-keyword">var</span> $element = $(element);
            <span class="hljs-keyword">return</span> $element.is(<span class="hljs-string">":emptyText"</span>) || $element.is(<span class="hljs-string">":rangySpan"</span>);
        },
        <span class="hljs-comment">/**
         * Find all elements that have block level children nodes
         * Usage: $("div").not(":blockChildren") - will return all div elements that don't have block children
         */</span>
        blockChildren: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Get all children of current element, remove the element itself and filter out none block children;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> $(element).children().not(<span class="hljs-keyword">this</span>).filter(<span class="hljs-string">":block"</span>).length &gt; <span class="hljs-number">0</span>;
        }
    });

    <span class="hljs-comment">/**
     * Get a next or previous sibling node (text or element) and allows filtering
     * @param {htmlNodes} nodes
     * @param {bool} direction
     * @param {function} additional filtering (for example, excluding empty nodes)
     * @return next or previous node
     */</span>
    <span class="hljs-keyword">var</span> seekDirection = {
        Next: <span class="hljs-number">0</span>,
        Prev: <span class="hljs-number">1</span>
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSiblingIncludingTextNodes</span><span class="hljs-params">(nodes, direction, filter)</span> </span>{
        <span class="hljs-keyword">var</span> allNodes = $();
        <span class="hljs-keyword">var</span> isNext = direction === seekDirection.Next;
        nodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> result;
            <span class="hljs-keyword">var</span> children = $(<span class="hljs-keyword">this</span>).parent().contents().get();
            <span class="hljs-keyword">var</span> index = $.inArray($(<span class="hljs-keyword">this</span>).get(<span class="hljs-number">0</span>), children);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Based on the seekDirection, we want to move forward or backward</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> increment = isNext ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = index + increment; isNext ? i &lt; children.length : i &gt;= <span class="hljs-number">0</span>; i = i + increment) {
                <span class="hljs-keyword">var</span> filterResult = filter ? filter(i, children[i]) : <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (filterResult) {
                    result = children[i];
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">if</span> (result) {
                allNodes.push(result);
            }
        });
        <span class="hljs-keyword">return</span> allNodes;
    }

    <span class="hljs-comment">/**
     * Overriding jQuery native function that can't operate on text nodes.
     */</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.documentElement.contains) {
        jQuery.contains = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>IE contains function on the same node will return true, vs. other browsers returning false.
This code will to fix this behavior.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (a === b) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>if a is a text node it can’t contain anything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (a.nodeType === <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Sizzle can’t handle contains when one of the parameters is a textNode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> bup = b.parentNode || {};
            <span class="hljs-keyword">return</span> a === bup || (bup.nodeType === <span class="hljs-number">1</span> ? (!a.contains || a.contains(bup)) :
                ((a !== b &amp;&amp; a.contains) ? a.contains(b) : <span class="hljs-literal">true</span>));
        };
    }

    $.extend(dom, {
        <span class="hljs-comment">/**
         * Get top most parent such that there are is either no block child or only one block child
         * @param {jElement} topMostElement absolute ceiling (for example the top content editable element).
         * @return {jElement} parent node or the input jquery object
         */</span>
        closestWithAtMostOneBlockChild: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, topMostElement)</span> </span>{
            <span class="hljs-keyword">var</span> allNodes = [];
            jNode.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> parent = <span class="hljs-literal">null</span>;
                $(<span class="hljs-keyword">this</span>).parentsUntil(topMostElement).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">var</span> blockChildrenCount = $(<span class="hljs-keyword">this</span>).children(<span class="hljs-string">":block"</span>).length;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>0 or 1 block child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> isValid = (blockChildrenCount === <span class="hljs-number">0</span>) ||</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>There are not other non-block children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        (blockChildrenCount === <span class="hljs-number">1</span> &amp;&amp; blockChildrenCount === <span class="hljs-keyword">this</span>.childNodes.length);
                    <span class="hljs-keyword">if</span> (isValid) {
                        parent = <span class="hljs-keyword">this</span>;
                    }
                    <span class="hljs-keyword">return</span> isValid;
                });
                <span class="hljs-keyword">var</span> result = parent || <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>don’t include duplicate nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> ($.inArray(result, allNodes) === -<span class="hljs-number">1</span>) {
                    allNodes.push(result);
                }
            });

            <span class="hljs-keyword">return</span> $(allNodes);
        },

        <span class="hljs-comment">/**
         * Get previous node (text or element) and allows filtering
         * @param {function} additional filtering (for example, excluding empty nodes)
         * @return previous node
         */</span>
        prevSiblingIncludingTextNodes: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNodes, filter)</span> </span>{
            <span class="hljs-keyword">return</span> getSiblingIncludingTextNodes(jNodes, seekDirection.Prev, filter);
        },

        <span class="hljs-comment">/**
         * Get next node (text or element) and allows filtering
         * @param {function} additional filtering (for example, excluding empty nodes)
         * @return next node
         */</span>
        nextSiblingIncludingTextNodes: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNodes, filter)</span> </span>{
            <span class="hljs-keyword">return</span> getSiblingIncludingTextNodes(jNodes, seekDirection.Next, filter);
        },

        <span class="hljs-comment">/**
         * Split the classes of a jQuery element
         * @return {array} List of classes
         */</span>
        getClasses: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode)</span> </span>{
            <span class="hljs-keyword">var</span> result = [];
            <span class="hljs-keyword">var</span> classString = jNode.attr(<span class="hljs-string">"class"</span>);
            <span class="hljs-keyword">if</span> (classString) {
                result = classString.split(<span class="hljs-regexp">/\s+/</span>);
            }
            <span class="hljs-keyword">return</span> result;
        },

        <span class="hljs-comment">/**
         * Parses the styles of the first object in the jQuery element
         * @return {array} an object representing the styles and their values
         */</span>
        getStyles: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode)</span> </span>{
            <span class="hljs-keyword">var</span> returnValue = {};
            <span class="hljs-keyword">if</span> (jNode.prop(<span class="hljs-string">"nodeType"</span>) === constants.nodeType.TEXT) { <span class="hljs-comment">// Text nodes won't have any styles set.</span>
                <span class="hljs-keyword">return</span> returnValue;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>The css style enumeration doesn’t work in IE7 so we have to use the cssText to check which styles are set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> style = jNode.attr(<span class="hljs-string">"style"</span>);
            <span class="hljs-keyword">var</span> cssText = (style) ? style.toLowerCase().split(<span class="hljs-string">";"</span>) : [];

            $.each(cssText, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, value)</span> </span>{
                value = $.trim(value);
                <span class="hljs-keyword">if</span> (!value) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">var</span> index = value.indexOf(<span class="hljs-string">":"</span>);
                <span class="hljs-keyword">var</span> styleKey = $.trim(value.substring(<span class="hljs-number">0</span>, index));
                <span class="hljs-keyword">var</span> styleValue = $.trim(value.substring(index + <span class="hljs-number">1</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Note: in IE setting the css value of a style to “” would retain this value in the cssText
Filter out the null/empty values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (styleValue) {
                    returnValue[styleKey] = styleValue;
                }
            });
            <span class="hljs-keyword">return</span> returnValue;
        },

        <span class="hljs-comment">/**
         * Check if a particular command is applied to the node
         * For example, the nodes &lt;span style="font-weight:bold"&gt;ABC&lt;/span&gt; or &lt;span class="arte-font-weight"&gt;ABC&lt;/span&gt;
         * have font-weight command applied and &lt;b&gt;ABC&lt;/b&gt; have bold command applied
         * @param {string} commandName [see Arte.configuration.commands]
         */</span>
        hasCommandApplied: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNodes, commandName)</span> </span>{
            <span class="hljs-keyword">var</span> result = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> commandConfig = configuration.commands[commandName];
            jNodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.nodeType === constants.nodeType.TEXT) {
                    result = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span> result;
                }
                <span class="hljs-keyword">var</span> styles = dom.getStyles($<span class="hljs-keyword">this</span>);
                result = (commandConfig.classNameRegex &amp;&amp; dom.hasClassWithPattern($<span class="hljs-keyword">this</span>, commandConfig.classNameRegex)) ||
                    (commandConfig.styleName &amp;&amp; styles[commandConfig.styleName]) ||
                    (commandConfig.tagName &amp;&amp; <span class="hljs-keyword">this</span>.tagName === commandConfig.tagName);
                <span class="hljs-keyword">return</span> result;
            });
            <span class="hljs-keyword">return</span> result;
        },

        <span class="hljs-comment">/**
         * Check if a particular style, class, tag is applied to the node
         * @param jNode
         * @param options Set of options for this command
         * @param [options.className] className, (e.g. arte-font-weight)
         * @param [options.styleName] styleName (e.g. font-weight)
         * @param [options.styleValue] styleValue (e.g. bold)
         * @param [options.tagName] tagName (e.g. p or div)
         */</span>
        hasCommandValue: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, options)</span> </span>{
            <span class="hljs-keyword">var</span> result = <span class="hljs-literal">false</span>;
            jNode.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $(<span class="hljs-keyword">this</span>);
                result = (options.className &amp;&amp; $<span class="hljs-keyword">this</span>.hasClass(options.className)) ||
                    (options.styleName &amp;&amp; dom.getStyles($<span class="hljs-keyword">this</span>)[options.styleName] === options.styleValue) ||
                    (options.tagName &amp;&amp; $<span class="hljs-keyword">this</span>.prop(<span class="hljs-string">"tagName"</span>) === options.tagName);
                <span class="hljs-keyword">return</span> result;
            });
            <span class="hljs-keyword">return</span> result;
        },

        getCommandValue: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, options)</span> </span>{
            <span class="hljs-keyword">var</span> result = {};
            <span class="hljs-keyword">var</span> commandConfig = configuration.commands[options.commandName];
            jNode.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">var</span> styles = dom.getStyles($<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">if</span> (options.className &amp;&amp; $<span class="hljs-keyword">this</span>.hasClass(options.className)) {
                    result.className = options.className;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dom.hasClassWithPattern($<span class="hljs-keyword">this</span>, commandConfig.classNameRegex)) {
                    result.className = dom.getClassWithPattern($<span class="hljs-keyword">this</span>, commandConfig.classNameRegex)[<span class="hljs-number">0</span>];
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.styleName &amp;&amp; styles[options.styleName]) {
                    result.styleName = styles[options.styleName];
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.tagName &amp;&amp; $<span class="hljs-keyword">this</span>.prop(<span class="hljs-string">"tagName"</span>) === commandConfig.tagName) {
                    result.tagName = $<span class="hljs-keyword">this</span>.prop(<span class="hljs-string">"tagName"</span>);
                }
                <span class="hljs-keyword">return</span> result;
            });
            <span class="hljs-keyword">return</span> result;
        },
        <span class="hljs-comment">/**
         * Check if the input element has a class that matches the pattern
         * @param jNode
         * @param {string} regex pattern (see Arte.configuration.commands)
         * @return {bool} whether the element has a class with the pattern
         */</span>
        hasClassWithPattern: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, pattern)</span> </span>{
            <span class="hljs-keyword">return</span> pattern.test(jNode.attr(<span class="hljs-string">"class"</span>));
        },

        <span class="hljs-comment">/**
         * Gets the class that matches the pattern
         * @param jNode
         * @param {string} regex pattern (see Arte.configuration.commands)
         * @return {string} Returns the class with pattern or null
         */</span>
        getClassWithPattern: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, pattern)</span> </span>{
            <span class="hljs-keyword">return</span> pattern.exec(jNode.attr(<span class="hljs-string">"class"</span>));
        },

        <span class="hljs-comment">/**
         *  Remove class that matches the pattern
         * @param jNode
         * @param {string} regex pattern (see Arte.configuration.commands)
         */</span>
        removeClassWithPattern: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, pattern)</span> </span>{
            <span class="hljs-keyword">var</span> classNames = dom.getClassWithPattern(jNode, pattern) || [];
            $.each(classNames, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, className)</span> </span>{
                jNode.removeClass(className);
            });
        },

        <span class="hljs-comment">/**
         * Checks if all the list elements are surrounded by same list parent
         * @param jNodes Collection of LI elements
         * @return {bool} Whether all of the list elements have same parent
         */</span>
        hasSameListParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNodes)</span> </span>{
            <span class="hljs-keyword">var</span> parent = jNodes.first().closest(constants.tagName.LI).parent();
            <span class="hljs-keyword">if</span> (parent.length === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">var</span> hasSameParent = <span class="hljs-literal">true</span>;
            jNodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                hasSameParent = parent.has(<span class="hljs-keyword">this</span>).length !== <span class="hljs-number">0</span>;
                <span class="hljs-keyword">return</span> hasSameParent;
            });
            <span class="hljs-keyword">return</span> hasSameParent;
        },

        <span class="hljs-comment">/**
         * Checks if all the input elements have a class
         * @param {string} className
         * @return {bool} Whether all of the selected nodes have the className applied
         */</span>
        allHaveClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNodes, className)</span> </span>{
            <span class="hljs-keyword">var</span> hasClass = <span class="hljs-literal">true</span>;
            jNodes.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                hasClass = $(<span class="hljs-keyword">this</span>).hasClass(className);
                <span class="hljs-keyword">return</span> hasClass;
            });
            <span class="hljs-keyword">return</span> hasClass;
        },

        <span class="hljs-comment">/**
         * Checks whether jLeftNode and jRightNode have same classes applied.
         * @param {jLeftNode} jQuery Node
         * @param {jRightNode} jQuery Node
         * @return {bool} whether both elements have same classes applied
         */</span>
        hasSameClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jLeftNode, jRightNode)</span> </span>{
            <span class="hljs-keyword">var</span> thisClasses = {};
            <span class="hljs-keyword">var</span> thatClasses = {};
            $.each(dom.getClasses(jLeftNode), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                thisClasses[<span class="hljs-keyword">this</span>] = <span class="hljs-number">1</span>;
            });
            $.each(dom.getClasses(jRightNode), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                thatClasses[<span class="hljs-keyword">this</span>] = <span class="hljs-number">1</span>;
            });
            <span class="hljs-keyword">return</span> util.all(thisClasses, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span> </span>{
                    <span class="hljs-keyword">return</span> thatClasses[key];
                }) &amp;&amp;
                util.all(thatClasses, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span> </span>{
                    <span class="hljs-keyword">return</span> thisClasses[key];
                });
        },

        <span class="hljs-comment">/**
         * Checks whether jLeftNode and jRightNode have same styles applied.
         * @param {jLeftNode} jQuery Node
         * @param {jRightNode} jQuery Node
         * @return {bool} whether both elements have same styles applied
         */</span>
        hasSameStyle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jLeftNode, jRightNode)</span> </span>{
            <span class="hljs-keyword">var</span> thisStyles = dom.getStyles(jLeftNode);
            <span class="hljs-keyword">var</span> thatStyles = dom.getStyles(jRightNode);
            <span class="hljs-keyword">return</span> util.all(thisStyles, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, value)</span> </span>{
                    <span class="hljs-keyword">return</span> thatStyles[key] === value;
                }) &amp;&amp;
                util.all(thatStyles, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, value)</span> </span>{
                    <span class="hljs-keyword">return</span> thisStyles[key] === value;
                });
        },

        <span class="hljs-comment">/**
         * Checks whether jLeftNode and jRightNode have same styles and same classes applied.
         * @param {jLeftNode} jQuery Node
         * @param {jRightNode} jQuery Node
         * @return {bool} whether both elements have same styles and classes applied
         */</span>
        hasSameStyleAndClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jLeftNode, jRightNode)</span> </span>{
            <span class="hljs-keyword">return</span> dom.hasSameStyle(jLeftNode, jRightNode) &amp;&amp; dom.hasSameClass(jLeftNode, jRightNode);
        },

        <span class="hljs-comment">/**
         * Get the closest node to which the command value is applied
         * @param jNode
         * @param options see closestWithCommand for more information
         * @return {jElements}  Set of jQuery elements that have the command applied
         */</span>
        closestWithCommandValue: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, options)</span> </span>{
            <span class="hljs-keyword">return</span> dom.closestWithCommand(jNode, $.extend(options, {
                checkValue: <span class="hljs-number">1</span>
            }));
        },

        <span class="hljs-comment">/*
         * Evaluates an element or its parents have a style/class/tag applied
         * @param jNode
         * @param options Command Options
         * @param [options.commandName] commandName; if not supplied the command is inferred from the styleName or className
         * @param [options.styleName] name of css style to check
         * @param [options.styleValue] value of the css style to verify if checkValue is set
         * @param [options.className] name of the class to check
         * @param [options.topEditbleParent] ceiling html node to evaluate for result
         * @param [options.checkValue] whether to check the style/class value
         * @return {jElements}  Set of jQuery elements that have the command applied
         */</span>
        closestWithCommand: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, options)</span> </span>{
            <span class="hljs-keyword">var</span> result = $();
            <span class="hljs-keyword">var</span> commandConfig = util.getCommandConfig(options);
            <span class="hljs-keyword">if</span> (!commandConfig) {
                <span class="hljs-keyword">return</span> result;
            }

            jNode.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">var</span> topLevelNode = options.topEditableParent || dom.getTopEditableParent($<span class="hljs-keyword">this</span>).get(<span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span> (topLevelNode) {
                    <span class="hljs-keyword">var</span> parentsAndSelf = $<span class="hljs-keyword">this</span>.parentsUntil(topLevelNode.parentNode);
                    parentsAndSelf.splice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>);
                    parentsAndSelf.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                        <span class="hljs-keyword">if</span> (dom.hasCommandApplied($(<span class="hljs-keyword">this</span>), commandConfig.commandName)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Add to result if check value is not requested or the node has the command value applied</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (!options.checkValue || dom.hasCommandValue($(<span class="hljs-keyword">this</span>), options)) {
                                result.push(<span class="hljs-keyword">this</span>);
                            }
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// Exit the loop</span>
                        }
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    });
                }
            });
            <span class="hljs-keyword">return</span> result;
        },

        <span class="hljs-comment">/*
         * Get the top contentEditableElement or TextArea
         * @param jNode
         * @return {jElement} top level editable element
         */</span>
        getTopEditableParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode)</span> </span>{
            <span class="hljs-keyword">var</span> contentEditable = jNode.closest(<span class="hljs-string">"[contenteditable=true]"</span>);
            <span class="hljs-keyword">return</span> contentEditable.length ? contentEditable : jNode.closest(<span class="hljs-string">"textarea"</span>);
        },

        <span class="hljs-comment">/**
         * Checks if all of the input nodes are surrounded by a list
         * @param {options}
         *   singleList: true|false
         *   tagName: OL|UL
         * @return boolean
         */</span>
        listSurrounded: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode, options)</span> </span>{
            <span class="hljs-keyword">var</span> allNodesListSurrounded = util.all(jNode, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, node)</span> </span>{
                <span class="hljs-keyword">return</span> $(node).closest(constants.tagName.LI).parents(<span class="hljs-string">"[contenteditable=true]"</span>).get(<span class="hljs-number">0</span>);
            });

            <span class="hljs-keyword">if</span> (allNodesListSurrounded) {
                <span class="hljs-keyword">var</span> parents = jNode.closest(constants.tagName.LI).parent();
                <span class="hljs-keyword">if</span> (options &amp;&amp; options.singleList &amp;&amp; parents.length &gt; <span class="hljs-number">1</span>) { <span class="hljs-comment">// the LI elements belong to different lists</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                <span class="hljs-keyword">if</span> (options &amp;&amp; options.tagName) {
                    <span class="hljs-keyword">var</span> hasSameTagName = <span class="hljs-literal">false</span>;
                    parents.each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, element)</span> </span>{
                        hasSameTagName = element.tagName === options.tagName;
                        <span class="hljs-keyword">return</span> hasSameTagName;
                    });
                    <span class="hljs-keyword">return</span> hasSameTagName;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        },

        isEqual: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(jNode1, jNode2)</span> </span>{
            <span class="hljs-keyword">if</span> (!jNode1.get(<span class="hljs-number">0</span>) || !jNode2.get(<span class="hljs-number">0</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">var</span> isEqual = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Attributes to check when comparing the nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> attributes = [<span class="hljs-string">"style"</span>, <span class="hljs-string">"id"</span>, <span class="hljs-string">"class"</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>compare node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (jNode1.prop(<span class="hljs-string">"tagName"</span>) === jNode2.prop(<span class="hljs-string">"tagName"</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>compare attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $.each(attributes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, attrib)</span> </span>{
                    <span class="hljs-keyword">if</span> (attrib === <span class="hljs-string">"style"</span>) {
                        isEqual = $.Arte.dom.hasSameStyle(jNode1, jNode2);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attrib === <span class="hljs-string">"class"</span>) {
                        isEqual = $.Arte.dom.hasSameClass(jNode1, jNode2);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">var</span> thisAttr = jNode1.attr(attrib) &amp;&amp; $.trim(jNode1.attr(attrib));
                        <span class="hljs-keyword">var</span> thatAttr = jNode2.attr(attrib) &amp;&amp; $.trim(jNode2.attr(attrib));

                        isEqual = thisAttr === thatAttr;
                    }
                    <span class="hljs-keyword">return</span> isEqual;
                });

                <span class="hljs-keyword">if</span> (isEqual) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>check children nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> noEmptyTextNodesFilter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, node)</span> </span>{
                        <span class="hljs-keyword">return</span> !$(node).is(<span class="hljs-string">":emptyText"</span>);
                    };
                    <span class="hljs-keyword">var</span> thisContent = jNode1.contents().filter(noEmptyTextNodesFilter);
                    <span class="hljs-keyword">var</span> thatContent = jNode2.contents().filter(noEmptyTextNodesFilter);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>has same child count</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    isEqual = thisContent.length === thatContent.length;

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = thisContent.length; i &lt; l &amp;&amp; isEqual; i++) {
                        isEqual = thisContent[i].nodeType === <span class="hljs-number">3</span> ?
                            $.trim(thisContent[i].nodeValue) === $.trim(thatContent[i].nodeValue) :
                            $.Arte.dom.isEqual($(thisContent[i]), $(thatContent[i]));
                    }
                }
            } <span class="hljs-keyword">else</span> {
                isEqual = <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">return</span> isEqual;
        }
    });

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
